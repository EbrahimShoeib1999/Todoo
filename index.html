<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LifeOS V14 | نظام الإنتاجية المتكامل</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Font: Cairo -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Cairo', 'sans-serif'],
                        cairo: ['Cairo', 'sans-serif']
                    },
                    colors: {
                        background: "#ffffff",
                        surface: "#f7f7f5", 
                        border: "#e9e9e7",
                        primary: "#2563eb", 
                        secondary: "#16a34a",
                        accent: "#2563eb", 
                        success: "#16a34a",
                        warning: "#ca8a04",
                        danger: "#dc2626",
                        info: "#0891b2",
                        purple: "#7c3aed",
                        pink: "#db2777",
                        teal: "#0d9488",
                        orange: "#ea580c",
                        blue: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                        'slide-in': 'slideIn 0.3s ease-out forwards',
                        'pulse': 'pulse 2s infinite',
                        'bounce': 'bounce 1s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(5px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(20px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        bounce: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #16a34a;
            --background-color: #ffffff;
            --surface-color: #f7f7f5;
            --text-color: #2e2e2e;
            --card-bg: #ffffff;
            --sidebar-bg: #f7f7f5;
            --border-color: #e9e9e7;
            --input-bg: #ffffff;
            --input-text: #2e2e2e;
            --table-header-bg: #f8fafc;
            --table-header-text: #64748b;
        }

        .dark-mode {
            --primary-color: #3b82f6;
            --secondary-color: #10b981;
            --background-color: #0f172a;
            --text-color: #f1f5f9;
            --surface-color: #1e293b;
            --card-bg: #1e293b;
            --sidebar-bg: #1e293b;
            --border-color: #334155;
            --input-bg: #1e293b;
            --input-text: #f1f5f9;
            --table-header-bg: #334155;
            --table-header-text: #cbd5e1;
        }

        .theme-green {
            --primary-color: #16a34a;
        }

        .theme-purple {
            --primary-color: #7c3aed;
        }

        .theme-pink {
            --primary-color: #db2777;
        }

        .theme-teal {
            --primary-color: #0d9488;
        }

        .theme-orange {
            --primary-color: #ea580c;
        }

        body { 
            font-family: 'Cairo', sans-serif;
            background-color: var(--background-color); 
            color: var(--text-color); 
            -webkit-font-smoothing: antialiased; 
            transition: all 0.3s ease;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        /* إصلاح الخطوط في الوضع الداكن */
        .dark-mode input,
        .dark-mode textarea,
        .dark-mode select,
        .dark-mode .notion-input,
        .dark-mode .tab-button,
        .dark-mode .calendar-day,
        .dark-mode .kanban-card,
        .dark-mode .finance-card,
        .dark-mode .card {
            color: var(--text-color) !important;
        }

        .dark-mode .notion-input {
            background-color: var(--input-bg);
            border-color: var(--border-color);
            color: var(--input-text);
        }

        .dark-mode .notion-input::placeholder {
            color: #94a3b8;
        }

        .dark-mode table thead {
            background-color: var(--table-header-bg) !important;
            color: var(--table-header-text) !important;
        }

        .dark-mode table thead th {
            color: var(--table-header-text) !important;
        }

        .dark-mode table tbody tr {
            border-color: var(--border-color);
        }

        .dark-mode table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.05) !important;
        }

        /* تحسين رؤية الأزرار في الوضع الداكن */
        .dark-mode .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), color-mix(in srgb, var(--primary-color) 70%, white));
            color: white;
        }

        .dark-mode .btn-primary:hover {
            background: linear-gradient(135deg, color-mix(in srgb, var(--primary-color) 90%, black), var(--primary-color));
        }

        /* تحسين رؤية البطاقات في الوضع الداكن */
        .dark-mode .glass-card {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        ::-webkit-scrollbar { 
            width: 8px; 
            height: 8px; 
        }
        ::-webkit-scrollbar-track { 
            background: var(--surface-color); 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb { 
            background: var(--primary-color); 
            border-radius: 4px; 
        }
        ::-webkit-scrollbar-thumb:hover { 
            background: color-mix(in srgb, var(--primary-color) 80%, transparent); 
        }
        
        /* Glass Effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* Input Styles */
        .notion-input { 
            background: var(--input-bg);
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            padding: 10px 14px; 
            width: 100%; 
            transition: all 0.3s; 
            font-family: 'Cairo', sans-serif;
            outline: none;
            color: var(--input-text);
            font-size: 14px;
        }
        .notion-input:hover { 
            background: color-mix(in srgb, var(--card-bg) 95%, var(--primary-color)); 
            border-color: color-mix(in srgb, var(--primary-color) 30%, transparent);
        }
        .notion-input:focus { 
            background: var(--card-bg); 
            border-color: var(--primary-color); 
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 20%, transparent); 
        }

        /* Checkbox */
        .custom-checkbox { 
            appearance: none; 
            background-color: var(--card-bg); 
            margin: 0; 
            width: 1.2em; 
            height: 1.2em; 
            border: 2px solid var(--border-color); 
            border-radius: 4px; 
            display: grid; 
            place-content: center; 
            cursor: pointer; 
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .custom-checkbox:hover {
            border-color: var(--primary-color);
        }
        .custom-checkbox::before { 
            content: ""; 
            width: 0.7em; 
            height: 0.7em; 
            transform: scale(0); 
            transition: 120ms transform ease-in-out; 
            background-color: white; 
            transform-origin: center; 
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%); 
        }
        .custom-checkbox:checked { 
            background-color: var(--primary-color); 
            border-color: var(--primary-color); 
        }
        .custom-checkbox:checked::before { 
            transform: scale(1); 
        }

        /* Toast */
        #toast-container { 
            position: fixed; 
            bottom: 20px; 
            left: 20px; 
            z-index: 1000; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            pointer-events: none; 
        }
        .toast { 
            background: var(--card-bg); 
            color: var(--text-color); 
            padding: 12px 20px; 
            border-radius: 8px; 
            font-size: 14px; 
            font-family: 'Cairo', sans-serif; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            pointer-events: auto; 
            transform: translateX(-20px); 
            opacity: 0; 
            animation: toastIn 0.3s forwards; 
            border-right: 4px solid var(--primary-color);
            max-width: 320px;
        }
        .toast.success { border-right-color: #16a34a; }
        .toast.error { border-right-color: #dc2626; }
        .toast.info { border-right-color: #0891b2; }

        @keyframes toastIn { 
            to { 
                transform: translateX(0); 
                opacity: 1; 
            } 
        }
        @keyframes toastOut { 
            to { 
                transform: translateX(-20px); 
                opacity: 0; 
            } 
        }

        /* Sidebar */
        #sidebar { 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            background-color: var(--sidebar-bg);
            border-left: 1px solid var(--border-color);
        }
        @media (min-width: 768px) { 
            #sidebar { 
                transform: translateX(0) !important; 
            } 
        }
        @media (max-width: 767px) { 
            #sidebar { 
                transform: translateX(100%); 
            } 
            #sidebar.open { 
                transform: translateX(0); 
            } 
        }
        
        /* Nav Item Active State */
        .nav-item.active {
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
            color: var(--primary-color) !important;
            border-right: 3px solid var(--primary-color);
        }
        .nav-item.active .icon-container {
            background: color-mix(in srgb, var(--primary-color) 20%, transparent) !important;
            color: var(--primary-color) !important;
        }

        /* Priority Badges */
        .priority-critical { background: #dc2626; color: white; }
        .priority-high { background: #ea580c; color: white; }
        .priority-medium { background: #ca8a04; color: white; }
        .priority-low { background: #16a34a; color: white; }

        /* Status Badges */
        .status-active { background: #10b981; color: white; }
        .status-inactive { background: #6b7280; color: white; }
        .status-completed { background: #8b5cf6; color: white; }
        .status-pending { background: #f59e0b; color: white; }

        /* Kanban Board */
        .kanban-column {
            min-height: 500px;
            background: color-mix(in srgb, var(--surface-color) 50%, transparent);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
        }
        .kanban-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: move;
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }
        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }
        .kanban-card.dragging {
            opacity: 0.5;
            transform: scale(1.02);
        }
        
        /* Progress Bars */
        .progress-bar {
            height: 6px;
            background: color-mix(in srgb, var(--text-color) 10%, transparent);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), color-mix(in srgb, var(--primary-color) 70%, white));
            transition: width 0.5s ease;
        }
        
        /* Financial Cards */
        .finance-card {
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        .finance-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        /* Tab Styling */
        .tab-button {
            padding: 12px 24px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            color: var(--text-color);
            opacity: 0.7;
        }
        .tab-button:hover {
            opacity: 1;
            background: color-mix(in srgb, var(--primary-color) 5%, transparent);
        }
        .tab-button.active {
            border-bottom-color: var(--primary-color);
            opacity: 1;
            color: var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 5%, transparent);
        }

        /* Modal Styling */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        /* Dropdown Styling */
        .dropdown-content {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), color-mix(in srgb, var(--primary-color) 70%, white));
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, color-mix(in srgb, var(--primary-color) 90%, black), var(--primary-color));
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Card Styles */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        .card:hover {
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
        }

        /* Form Elements */
        select, input[type="date"], input[type="number"], input[type="text"], textarea {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--input-text);
            font-family: 'Cairo', sans-serif;
        }

        /* Focus States */
        *:focus {
            outline: 2px solid color-mix(in srgb, var(--primary-color) 50%, transparent);
            outline-offset: 2px;
        }

        /* Animation Classes */
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .animate-slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }

        /* Utility Classes */
        .text-primary {
            color: var(--primary-color) !important;
        }
        .bg-primary {
            background: var(--primary-color) !important;
        }
        .border-primary {
            border-color: var(--primary-color) !important;
        }

        /* Filter Dropdown */
        .filter-dropdown {
            max-height: 300px;
            overflow-y: auto;
        }

        /* Calendar Styling */
        .calendar-day {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-color);
        }
        .calendar-day:hover {
            background: color-mix(in srgb, var(--primary-color) 10%, transparent);
        }
        .calendar-day.active {
            background: var(--primary-color);
            color: white;
        }

        /* Loading States */
        .loading {
            position: relative;
            overflow: hidden;
        }
        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--primary-color) 10%, transparent), transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Line Clamp */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Responsive Adjustments */
        @media (max-width: 640px) {
            .container-padding {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .mobile-stack {
                flex-direction: column;
            }
            .mobile-full {
                width: 100% !important;
            }
        }

        /* Dark Mode Specific Fixes */
        .dark-mode select option {
            background-color: #1e293b;
            color: #f1f5f9;
        }

        .dark-mode input[type="range"] {
            background: #334155;
        }

        .dark-mode input[type="range"]::-webkit-slider-thumb {
            background: var(--primary-color);
        }

        .dark-mode input[type="range"]::-moz-range-thumb {
            background: var(--primary-color);
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .card, .finance-card {
                border: 1px solid #ddd !important;
                box-shadow: none !important;
            }
        }
    </style>
</head>
<body class="font-cairo theme-blue" dir="rtl">

    <!-- AUTH SCREEN -->
    <div id="auth-screen" class="fixed inset-0 bg-gradient-to-br from-blue-50 to-purple-50 z-50 flex items-center justify-center p-4 dark:from-gray-900 dark:to-gray-800">
        <div class="glass-card p-8 rounded-2xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-2xl flex items-center justify-center font-bold text-3xl mx-auto mb-4 shadow-lg animate-pulse">
                    <i data-lucide="zap"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">LifeOS V14</h1>
                <p class="text-gray-500 dark:text-gray-400 text-sm mt-2">نظام الإنتاجية الشخصية المتقدم</p>
            </div>
            <form id="auth-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">اسم المستخدم / البريد الإلكتروني</label>
                    <input type="text" id="auth-username" class="notion-input" required placeholder="أدخل اسم المستخدم" value="admin">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">كلمة المرور</label>
                    <input type="password" id="auth-password" class="notion-input" required placeholder="أدخل كلمة المرور" value="admin123">
                </div>
                <div class="flex items-center justify-between">
                    <label class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                        <input type="checkbox" id="remember-me" class="rounded border-gray-300">
                        تذكرني
                    </label>
                </div>
                <div id="auth-error" class="text-red-500 text-sm hidden text-center bg-red-50 dark:bg-red-900/30 p-2 rounded">بيانات الدخول غير صحيحة</div>
                <button type="submit" class="w-full btn-primary py-3">
                    دخول للنظام
                </button>
            </form>
            <div class="mt-6 text-center">
                <p class="text-xs text-gray-400">البيانات الافتراضية: admin / admin123</p>
            </div>
        </div>
    </div>

    <!-- MAIN APP LAYOUT -->
    <div id="app-container" class="flex h-screen relative hidden">

        <!-- SIDEBAR -->
        <aside id="sidebar" class="w-80 h-full flex flex-col fixed md:relative z-40">
            <div class="p-6 border-b border-gray-200 dark:border-gray-800 sticky top-0 z-10 flex justify-between items-center bg-inherit">
                <div class="flex items-center gap-3 cursor-pointer" onclick="App.navigate('dashboard')">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-xl flex items-center justify-center font-bold text-xl shadow-lg">
                        <i data-lucide="zap"></i>
                    </div>
                    <div>
                        <span class="font-bold text-lg tracking-tight block leading-none text-gray-900 dark:text-white">LifeOS V14</span>
                        <span class="text-xs text-gray-400 block leading-none mt-1">الإصدار المتكامل</span>
                    </div>
                </div>
                <button onclick="App.toggleSidebar()" class="md:hidden p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <nav class="flex-1 overflow-y-auto p-4 space-y-2">
                <!-- DASHBOARD -->
                <div>
                    <button onclick="App.navigate('dashboard')" class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-all text-gray-700 dark:text-gray-300">
                        <div class="icon-container p-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-gray-600 dark:text-gray-400 transition-colors">
                            <i data-lucide="layout-dashboard" class="w-4 h-4"></i>
                        </div>
                        لوحة التحكم
                    </button>
                </div>
                
                <!-- UNIFIED SYSTEM CENTER - FIXED LINKS -->
                <div>
                    <p class="px-4 text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 mt-6">المركز الموحد</p>
                    <button onclick="App.navigate('dailyTracker')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-green-100 dark:bg-green-900/30 rounded-lg text-green-600">
                            <i data-lucide="check-square" class="w-4 h-4"></i>
                        </div>
                        المتابعة اليومية
                    </button>
                    <button onclick="App.navigate('weeklyReview')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600">
                            <i data-lucide="calendar" class="w-4 h-4"></i>
                        </div>
                        المراجعة الأسبوعية
                    </button>
                    <button onclick="App.navigate('monthlyReview')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-purple-600">
                            <i data-lucide="calendar-days" class="w-4 h-4"></i>
                        </div>
                        المراجعة الشهرية
                    </button>
                    <button onclick="App.navigate('reviewResults')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg text-indigo-600">
                            <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                        </div>
                        نتائج المراجعات
                    </button>
                    <button onclick="App.navigate('aspectsEditor')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-600">
                            <i data-lucide="settings-2" class="w-4 h-4"></i>
                        </div>
                        إدارة الجوانب
                    </button>
                </div>

                <!-- ADVANCED FEATURES -->
                <div>
                    <p class="px-4 text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 mt-6">الميزات المتقدمة</p>
                    <button onclick="App.navigate('advancedGoals')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg text-orange-600">
                            <i data-lucide="target" class="w-4 h-4"></i>
                        </div>
                        الأهداف المتقدمة
                    </button>
                    <button onclick="App.navigate('financeAdvanced')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-green-100 dark:bg-green-900/30 rounded-lg text-green-600">
                            <i data-lucide="trending-up" class="w-4 h-4"></i>
                        </div>
                        المالية المتقدمة
                    </button>
                    <button onclick="App.navigate('journalManager')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-teal-100 dark:bg-teal-900/30 rounded-lg text-teal-600">
                            <i data-lucide="book-open-text" class="w-4 h-4"></i>
                        </div>
                        مدوناتي
                    </button>
                    <button onclick="App.navigate('secureNotes')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-pink-100 dark:bg-pink-900/30 rounded-lg text-pink-600">
                            <i data-lucide="lock" class="w-4 h-4"></i>
                        </div>
                        الملاحظات الآمنة
                    </button>
                    <button onclick="App.navigate('projects')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600">
                            <i data-lucide="briefcase" class="w-4 h-4"></i>
                        </div>
                        المشاريع
                    </button>
                </div>

                <!-- SYSTEM -->
                <div>
                    <p class="px-4 text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 mt-6">النظام</p>
                    <button onclick="App.navigate('settings')" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-600 dark:text-gray-400">
                        <div class="icon-container p-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-600">
                            <i data-lucide="settings" class="w-4 h-4"></i>
                        </div>
                        الإعدادات المتقدمة
                    </button>
                    <button onclick="Auth.logout()" class="nav-item w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 hover:text-red-700 transition-colors">
                        <div class="icon-container p-2 bg-red-100 dark:bg-red-900/30 rounded-lg text-red-600">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                        </div>
                        خروج
                    </button>
                </div>

                <!-- QUICK STATS -->
                <div class="mt-8 p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-900 rounded-xl">
                    <p class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-2">إحصائيات سريعة</p>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600 dark:text-gray-300">إنجاز اليوم</span>
                            <span id="sidebar-today-progress" class="font-bold text-green-600">0%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600 dark:text-gray-300">الأهداف النشطة</span>
                            <span id="sidebar-active-goals" class="font-bold text-blue-600">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600 dark:text-gray-300">المهام المعلقة</span>
                            <span id="sidebar-pending-tasks" class="font-bold text-orange-600">0</span>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- SIDEBAR OVERLAY -->
        <div id="sidebar-overlay" onclick="App.toggleSidebar()" class="fixed inset-0 bg-black/60 z-30 hidden md:hidden backdrop-blur-sm transition-opacity"></div>

        <!-- MAIN CONTENT -->
        <main class="flex-1 h-full overflow-y-auto relative flex flex-col">
            <!-- TOP NAV -->
            <header class="sticky top-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 px-6 py-3 flex justify-between items-center z-20 shadow-sm">
                <div class="flex items-center gap-2">
                    <button onclick="App.toggleSidebar()" class="p-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-gray-600 dark:text-gray-400 md:hidden">
                        <i data-lucide="menu"></i>
                    </button>
                    <div class="flex items-center gap-2 font-bold text-lg text-gray-800 dark:text-white">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded flex items-center justify-center text-sm">
                            <i data-lucide="zap"></i>
                        </div> 
                        <span id="app-title">LifeOS V14</span>
                        <span class="text-xs font-normal text-gray-500">| <span id="current-page-title">لوحة التحكم</span></span>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <!-- Quick Actions -->
                    <div class="flex items-center gap-2">
                        <button onclick="App.quickAdd('task')" class="p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" title="إضافة مهمة">
                            <i data-lucide="plus-circle"></i>
                        </button>
                        <button onclick="App.quickAdd('note')" class="p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" title="إضافة ملاحظة">
                            <i data-lucide="sticky-note"></i>
                        </button>
                        <button onclick="App.toggleTheme()" class="p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" title="تبديل السمة">
                            <i data-lucide="moon" id="theme-icon"></i>
                        </button>
                    </div>
                    
                    <!-- Notifications -->
                    <div class="relative">
                        <button onclick="App.toggleNotifications()" class="p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg relative">
                            <i data-lucide="bell"></i>
                            <span id="notification-badge" class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hidden">3</span>
                        </button>
                        <div id="notifications-dropdown" class="absolute left-0 mt-2 w-80 dropdown-content rounded-lg shadow-lg hidden z-30">
                            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                <h4 class="font-bold text-gray-900 dark:text-white">الإشعارات</h4>
                            </div>
                            <div class="max-h-64 overflow-y-auto">
                                <div class="p-3 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800">
                                    <p class="text-sm">لديك 3 مهام معلقة اليوم</p>
                                    <p class="text-xs text-gray-500">منذ 2 ساعة</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="relative">
                        <button onclick="App.toggleUserMenu()" class="flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg">
                            <div id="user-avatar-small" class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full flex items-center justify-center text-sm">
                                <i data-lucide="user"></i>
                            </div>
                            <span id="user-name-small" class="text-sm font-medium hidden md:inline text-gray-700 dark:text-gray-300">مستخدم</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-gray-500"></i>
                        </button>
                        <div id="user-menu" class="absolute left-0 mt-2 w-48 dropdown-content rounded-lg shadow-lg hidden z-30">
                            <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                <p id="user-email" class="text-sm text-gray-500">user@example.com</p>
                            </div>
                            <div class="py-1">
                                <button onclick="App.navigate('profile')" class="w-full text-right px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">الملف الشخصي</button>
                                <button onclick="App.navigate('settings')" class="w-full text-right px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">الإعدادات</button>
                                <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                                <button onclick="Auth.logout()" class="w-full text-right px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30">تسجيل الخروج</button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- MAIN CONTENT AREA -->
            <div class="flex-1 overflow-y-auto">
                <div class="max-w-7xl mx-auto p-4 md:p-6 pb-24 w-full">
                    <div id="app-content"></div>
                </div>
            </div>
            
            <!-- FLOATING ACTION BUTTON -->
            <button onclick="App.showQuickActions()" class="fixed bottom-6 left-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full flex items-center justify-center shadow-lg z-30 hover:scale-110 transition-transform animate-bounce">
                <i data-lucide="plus" class="w-6 h-6"></i>
            </button>
        </main>
    </div>

    <!-- TOAST CONTAINER -->
    <div id="toast-container"></div>

    <!-- MODAL CONTAINER -->
    <div id="modal-container"></div>

    <!-- QUICK ACTIONS MODAL -->
    <div id="quick-actions-modal" class="fixed inset-0 modal-overlay z-40 hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="font-bold text-lg text-gray-900 dark:text-white">إضافة سريعة</h3>
            </div>
            <div class="p-6 grid grid-cols-2 gap-4">
                <button onclick="App.quickAction('task')" class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl flex flex-col items-center gap-2 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors">
                    <i data-lucide="check-square" class="w-6 h-6 text-blue-600"></i>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">مهمة</span>
                </button>
                <button onclick="App.quickAction('goal')" class="p-4 bg-green-50 dark:bg-green-900/30 rounded-xl flex flex-col items-center gap-2 hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors">
                    <i data-lucide="target" class="w-6 h-6 text-green-600"></i>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">هدف</span>
                </button>
                <button onclick="App.quickAction('note')" class="p-4 bg-purple-50 dark:bg-purple-900/30 rounded-xl flex flex-col items-center gap-2 hover:bg-purple-100 dark:hover:bg-purple-900/50 transition-colors">
                    <i data-lucide="sticky-note" class="w-6 h-6 text-purple-600"></i>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">ملاحظة</span>
                </button>
                <button onclick="App.quickAction('reminder')" class="p-4 bg-orange-50 dark:bg-orange-900/30 rounded-xl flex flex-col items-center gap-2 hover:bg-orange-100 dark:hover:bg-orange-900/50 transition-colors">
                    <i data-lucide="bell" class="w-6 h-6 text-orange-600"></i>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">تذكير</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        /* ===== 1. CORE SYSTEM ===== */
        class Database {
            constructor() {
                this.prefix = 'lifeos_v14_';
                this.init();
            }

            get(key, defaultValue = null) {
                try {
                    const data = localStorage.getItem(this.prefix + key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    console.error('Error reading from database:', error);
                    return defaultValue;
                }
            }

            set(key, value) {
                try {
                    localStorage.setItem(this.prefix + key, JSON.stringify(value));
                } catch (error) {
                    console.error('Error writing to database:', error);
                }
            }

            remove(key) {
                localStorage.removeItem(this.prefix + key);
            }

            clear() {
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith(this.prefix)) {
                        localStorage.removeItem(key);
                    }
                });
            }

            init() {
                // Initialize default data
                this.initUsers();
                this.initConfig();
                this.initGoals();
                this.initFinance();
                this.initNotes();
                this.initProjects();
                this.initJournals();
                this.initTasks();
                this.initReviewResults();
            }

            initUsers() {
                let users = this.get('users', []);
                if (users.length === 0) {
                    users = [{
                        id: 'user_001',
                        username: 'admin',
                        password: 'admin123',
                        email: 'admin@lifeos.com',
                        name: 'مدير النظام',
                        avatar: '',
                        plan: 'premium',
                        settings: {
                            theme: 'blue',
                            darkMode: false,
                            notifications: true,
                            language: 'ar',
                            fontSize: 'medium',
                            fontFamily: 'Cairo'
                        },
                        createdAt: new Date().toISOString(),
                        lastLogin: null
                    }];
                    this.set('users', users);
                }
                return users;
            }

            initConfig() {
                let config = this.get('config');
                if (!config) {
                    config = {
                        appTitle: 'LifeOS V14',
                        appLogo: '',
                        aspects: [
                            { id: 'a1', name: 'روحيات', icon: 'heart', color: '#dc2626', daily: ['صلاة الفجر', 'أذكار الصباح', 'قراءة قرآن'], weekly: ['درس ديني', 'صلاة الجمعة'], monthly: ['صدقة', 'زيارة مقابر'] },
                            { id: 'a2', name: 'نفسي', icon: 'brain', color: '#7c3aed', daily: ['تأمل 10 دقائق', 'قراءة صفحتين'], weekly: ['جلسة تأمل', 'مراجعة أهداف'], monthly: ['جلسة مع مختص'] },
                            { id: 'a3', name: 'تعلم', icon: 'graduation-cap', color: '#0891b2', daily: ['درس تقني', 'قراءة مقال'], weekly: ['مشروع تطبيقي', 'مراجعة'], monthly: ['دورة تدريبية'] },
                            { id: 'a4', name: 'تطبيق', icon: 'code', color: '#ea580c', daily: ['برمجة ساعة', 'حل مشكلة'], weekly: ['مشروع صغير', 'code review'], monthly: ['إطلاق مشروع'] },
                            { id: 'a5', name: 'صحة', icon: 'activity', color: '#16a34a', daily: ['تمارين', 'نوم 8 ساعات'], weekly: ['جيم', 'سباحة'], monthly: ['فحص دوري'] },
                            { id: 'a6', name: 'مال', icon: 'banknote', color: '#059669', daily: ['تسجيل مصروفات'], weekly: ['مراجعة ميزانية'], monthly: ['استثمار', 'تدقيق'] },
                            { id: 'a7', name: 'التزام', icon: 'check-circle', color: '#2563eb', daily: ['تقييم اليوم'], weekly: ['تقييم الأسبوع'], monthly: ['تقييم الشهر'] }
                        ],
                        categories: {
                            finance: ['طعام', 'مواصلات', 'تسوق', 'ترفيه', 'صحة', 'تعليم', 'استثمار', 'فواتير', 'هدايا'],
                            goals: ['مهني', 'شخصي', 'صحي', 'مالي', 'تعليمي', 'روحي', 'اجتماعي']
                        },
                        notifications: {
                            enabled: true,
                            taskReminders: true,
                            goalDeadlines: true,
                            weeklyReview: true
                        }
                    };
                    this.set('config', config);
                }
                return config;
            }

            initGoals() {
                let goals = this.get('goals', []);
                if (goals.length === 0) {
                    goals = [
                        {
                            id: 'g1',
                            title: 'إطلاق LifeOS V14',
                            description: 'تطوير وإطلاق النسخة النهائية من النظام',
                            type: 'long-term',
                            category: 'مهني',
                            priority: 'critical',
                            status: 'active',
                            progress: 85,
                            deadline: '2024-12-31',
                            createdAt: '2024-01-01',
                            updatedAt: new Date().toISOString(),
                            milestones: [
                                { id: 'm1', title: 'التخطيط والتصميم', completed: true },
                                { id: 'm2', title: 'التطوير الأساسي', completed: true },
                                { id: 'm3', title: 'إضافة الميزات المتقدمة', completed: false },
                                { id: 'm4', title: 'الاختبار والتجربة', completed: false },
                                { id: 'm5', title: 'الإطلاق النهائي', completed: false }
                            ],
                            tags: ['مشروع', 'تقنية', 'تطوير'],
                            notes: 'أهم مشروع حالي'
                        }
                    ];
                    this.set('goals', goals);
                }
                return goals;
            }

            initFinance() {
                let finance = this.get('finance', {});
                if (!finance.transactions) {
                    finance = {
                        transactions: [
                            { id: 't1', date: new Date().toISOString().split('T')[0], type: 'expense', amount: 150, category: 'طعام', description: 'عشاء خارجي', note: '' },
                            { id: 't2', date: new Date().toISOString().split('T')[0], type: 'income', amount: 5000, category: 'راتب', description: 'راتب الشهر', note: '' },
                            { id: 't3', date: new Date(Date.now() - 86400000).toISOString().split('T')[0], type: 'expense', amount: 300, category: 'مواصلات', description: 'بنزين', note: '' }
                        ],
                        budgets: [
                            { category: 'طعام', limit: 2000, spent: 1500, color: '#3b82f6' },
                            { category: 'مواصلات', limit: 1000, spent: 800, color: '#10b981' },
                            { category: 'تسوق', limit: 1500, spent: 1200, color: '#8b5cf6' },
                            { category: 'ترفيه', limit: 1000, spent: 600, color: '#f59e0b' }
                        ],
                        savings: 50000,
                        investments: 20000,
                        goals: [
                            { name: 'شراء سيارة', target: 100000, saved: 30000, deadline: '2025-12-31' },
                            { name: 'رحلة خارجية', target: 20000, saved: 8000, deadline: '2024-08-01' }
                        ]
                    };
                    this.set('finance', finance);
                }
                return finance;
            }

            initNotes() {
                let notes = this.get('notes', []);
                if (notes.length === 0) {
                    notes = [
                        {
                            id: 'n1',
                            title: 'كلمات مرور حسابات',
                            content: 'جيميل: ********\nفيسبوك: ********\nبنك: ********',
                            category: 'accounts',
                            tags: ['حساس', 'مهم'],
                            isEncrypted: true,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 'n2',
                            title: 'أفكار مشاريع',
                            content: '1. تطبيق للمدونات\n2. نظام إدارة مهام\n3. موقع تعليمي',
                            category: 'ideas',
                            tags: ['مشاريع', 'أفكار'],
                            isEncrypted: false,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        }
                    ];
                    this.set('notes', notes);
                }
                return notes;
            }

            initProjects() {
                let projects = this.get('projects', []);
                if (projects.length === 0) {
                    projects = [
                        {
                            id: 'p1',
                            name: 'LifeOS V14',
                            description: 'تطوير نظام الإنتاجية المتقدم',
                            status: 'in-progress',
                            progress: 85,
                            priority: 'high',
                            deadline: '2024-06-30',
                            createdAt: '2024-01-01',
                            tasks: [
                                { id: 't1', title: 'تصميم الواجهة', completed: true },
                                { id: 't2', title: 'تطوير الوظائف الأساسية', completed: true },
                                { id: 't3', title: 'إضافة الميزات المتقدمة', completed: false },
                                { id: 't4', title: 'الاختبار والتجربة', completed: false }
                            ],
                            team: [],
                            notes: 'أهم مشروع حالياً',
                            color: '#3b82f6'
                        }
                    ];
                    this.set('projects', projects);
                }
                return projects;
            }

            initJournals() {
                let journals = this.get('journals', []);
                if (journals.length === 0) {
                    journals = [
                        {
                            id: 'j1',
                            title: 'بداية رحلة LifeOS',
                            content: 'اليوم بدأت في تطوير LifeOS V14. أشعر بحماس كبير لهذا المشروع الذي سيساعد الكثيرين في تنظيم حياتهم.',
                            mood: 'excited',
                            tags: ['بداية', 'حماس', 'مشروع'],
                            date: new Date().toISOString(),
                            createdAt: new Date().toISOString()
                        }
                    ];
                    this.set('journals', journals);
                }
                return journals;
            }

            initTasks() {
                let tasks = this.get('tasks', []);
                if (tasks.length === 0) {
                    tasks = [
                        {
                            id: 't1',
                            title: 'مراجعة الأهداف الأسبوعية',
                            description: 'مراجعة وتحديث الأهداف للأسبوع القادم',
                            category: 'تخطيط',
                            priority: 'high',
                            status: 'pending',
                            dueDate: new Date().toISOString().split('T')[0],
                            completed: false,
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 't2',
                            title: 'جلسة برمجة صباحية',
                            description: 'العمل على ميزات جديدة للنظام',
                            category: 'عمل',
                            priority: 'critical',
                            status: 'in-progress',
                            dueDate: new Date().toISOString().split('T')[0],
                            completed: false,
                            createdAt: new Date().toISOString()
                        }
                    ];
                    this.set('tasks', tasks);
                }
                return tasks;
            }

            initReviewResults() {
                let reviewResults = this.get('review_results', {});
                if (!reviewResults.summaries) {
                    reviewResults = {
                        summaries: [],
                        trends: {},
                        insights: [],
                        comparisons: [],
                        generatedAt: new Date().toISOString()
                    };
                    this.set('review_results', reviewResults);
                }
                return reviewResults;
            }
        }

        /* ===== 2. AUTHENTICATION SYSTEM ===== */
        class Auth {
            static sessionKey = 'lifeos_session_v14';

            static check() {
                return !!sessionStorage.getItem(this.sessionKey);
            }

            static login(username, password) {
                const db = new Database();
                const users = db.get('users', []);
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    user.lastLogin = new Date().toISOString();
                    db.set('users', users);
                    sessionStorage.setItem(this.sessionKey, JSON.stringify(user));
                    return true;
                }
                return false;
            }

            static logout() {
                sessionStorage.removeItem(this.sessionKey);
                window.location.reload();
            }

            static getCurrentUser() {
                const session = sessionStorage.getItem(this.sessionKey);
                return session ? JSON.parse(session) : null;
            }

            static updateUser(user) {
                const db = new Database();
                const users = db.get('users', []);
                const index = users.findIndex(u => u.id === user.id);
                if (index !== -1) {
                    users[index] = user;
                    db.set('users', users);
                    sessionStorage.setItem(this.sessionKey, JSON.stringify(user));
                }
            }
        }

        /* ===== 3. APPLICATION STATE ===== */
        class AppState {
            static instance = null;

            constructor() {
                if (AppState.instance) return AppState.instance;
                
                this.db = new Database();
                this.user = Auth.getCurrentUser();
                this.config = this.db.get('config', {});
                this.goals = this.db.get('goals', []);
                this.finance = this.db.get('finance', {});
                this.notes = this.db.get('notes', []);
                this.projects = this.db.get('projects', []);
                this.journals = this.db.get('journals', []);
                this.tasks = this.db.get('tasks', []);
                this.data = this.db.get('data', {});
                this.reviewResults = this.db.get('review_results', {});
                
                this.currentDate = new Date().toISOString().split('T')[0];
                this.currentView = 'dashboard';
                this.currentPageTitle = 'لوحة التحكم';
                
                AppState.instance = this;
            }

            static getInstance() {
                if (!AppState.instance) {
                    AppState.instance = new AppState();
                }
                return AppState.instance;
            }

            save() {
                this.db.set('config', this.config);
                this.db.set('goals', this.goals);
                this.db.set('finance', this.finance);
                this.db.set('notes', this.notes);
                this.db.set('projects', this.projects);
                this.db.set('journals', this.journals);
                this.db.set('tasks', this.tasks);
                this.db.set('data', this.data);
                this.db.set('review_results', this.reviewResults);
                
                if (this.user) {
                    Auth.updateUser(this.user);
                }
            }

            updateUserSettings(settings) {
                if (this.user) {
                    this.user.settings = { ...this.user.settings, ...settings };
                    this.save();
                    this.applyTheme();
                }
            }

            applyTheme() {
                if (!this.user || !this.user.settings) return;
                
                const { theme, darkMode } = this.user.settings;
                
                // Remove existing theme classes
                document.body.classList.remove('theme-blue', 'theme-green', 'theme-purple', 'theme-pink', 'theme-teal', 'theme-orange', 'dark-mode');
                
                // Apply new theme
                if (theme) {
                    document.body.classList.add(`theme-${theme}`);
                }
                
                // Apply dark mode
                if (darkMode) {
                    document.body.classList.add('dark-mode');
                    document.getElementById('theme-icon')?.setAttribute('data-lucide', 'sun');
                } else {
                    document.getElementById('theme-icon')?.setAttribute('data-lucide', 'moon');
                }
                
                lucide.createIcons();
            }

            calculateTodayProgress() {
                const todayData = this.data[this.currentDate] || {};
                const checks = todayData.checks || {};
                const totalTasks = Object.keys(checks).length;
                if (totalTasks === 0) return 0;
                
                const completedTasks = Object.values(checks).filter(v => v).length;
                return Math.round((completedTasks / totalTasks) * 100);
            }

            getActiveGoals() {
                return this.goals.filter(g => g.status === 'active');
            }

            getPendingTasks() {
                return this.tasks.filter(t => !t.completed && t.status !== 'completed');
            }

            updateSidebarStats() {
                const todayProgress = this.calculateTodayProgress();
                const activeGoals = this.getActiveGoals().length;
                const pendingTasks = this.getPendingTasks().length;

                const todayProgressEl = document.getElementById('sidebar-today-progress');
                const activeGoalsEl = document.getElementById('sidebar-active-goals');
                const pendingTasksEl = document.getElementById('sidebar-pending-tasks');

                if (todayProgressEl) todayProgressEl.textContent = `${todayProgress}%`;
                if (activeGoalsEl) activeGoalsEl.textContent = activeGoals;
                if (pendingTasksEl) pendingTasksEl.textContent = pendingTasks;
            }

            // Review Results Methods
            generateReviewResults() {
                const today = new Date();
                const weekId = this.getWeekId(today);
                const monthId = this.getMonthId(today);
                
                // جمع البيانات
                const dailyData = this.data[this.currentDate] || {};
                const weekData = this.data[weekId] || {};
                const monthData = this.data[monthId] || {};
                
                // حساب الإحصائيات
                const stats = {
                    dailyScore: this.calculateTodayProgress(),
                    weeklyScore: this.calculateWeeklyProgress(weekData),
                    monthlyScore: this.calculateMonthlyProgress(monthData),
                    consistency: this.calculateConsistency(),
                    improvement: this.calculateImprovement(),
                    topPerformingAspects: this.getTopPerformingAspects(),
                    weakAspects: this.getWeakAspects(),
                    streakDays: this.getStreakDays(),
                    productiveDays: this.getProductiveDaysThisMonth()
                };
                
                // إنشاء الملخص
                const summary = {
                    id: 'summary_' + Date.now(),
                    date: this.currentDate,
                    period: 'daily',
                    scores: stats,
                    insights: this.generateInsights(stats),
                    recommendations: this.generateRecommendations(stats),
                    createdAt: new Date().toISOString()
                };
                
                // حفظ النتائج
                this.reviewResults.summaries.unshift(summary);
                if (this.reviewResults.summaries.length > 100) {
                    this.reviewResults.summaries = this.reviewResults.summaries.slice(0, 100);
                }
                
                // تحديث الاتجاهات
                this.updateTrends(stats);
                
                this.save();
                return summary;
            }

            calculateWeeklyProgress(weekData) {
                if (!weekData.checks) return 0;
                const checks = Object.values(weekData.checks);
                if (checks.length === 0) return 0;
                const completed = checks.filter(v => v).length;
                return Math.round((completed / checks.length) * 100);
            }

            calculateMonthlyProgress(monthData) {
                if (!monthData.checks) return 0;
                const checks = Object.values(monthData.checks);
                if (checks.length === 0) return 0;
                const completed = checks.filter(v => v).length;
                return Math.round((completed / checks.length) * 100);
            }

            calculateConsistency() {
                // حساب الانتظام على مدى الأسبوع الماضي
                let consistentDays = 0;
                for (let i = 0; i < 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const dayData = this.data[dateStr];
                    if (dayData && dayData.checks) {
                        const checks = Object.values(dayData.checks);
                        if (checks.length > 0) {
                            const completed = checks.filter(v => v).length;
                            if (completed >= checks.length * 0.7) {
                                consistentDays++;
                            }
                        }
                    }
                }
                return Math.round((consistentDays / 7) * 100);
            }

            calculateImprovement() {
                // مقارنة مع الأسبوع الماضي
                const lastWeekScore = 65; // سيتم حسابها من البيانات الفعلية
                const currentWeekScore = this.calculateWeeklyProgress(this.data[this.getWeekId(new Date())] || {});
                return currentWeekScore - lastWeekScore;
            }

            getTopPerformingAspects() {
                const aspects = this.config.aspects || [];
                return aspects
                    .map(aspect => ({
                        name: aspect.name,
                        score: this.calculateAspectScore(aspect.id)
                    }))
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 3);
            }

            getWeakAspects() {
                const aspects = this.config.aspects || [];
                return aspects
                    .map(aspect => ({
                        name: aspect.name,
                        score: this.calculateAspectScore(aspect.id)
                    }))
                    .sort((a, b) => a.score - b.score)
                    .slice(0, 2);
            }

            calculateAspectScore(aspectId) {
                let total = 0;
                let completed = 0;
                
                // حساب على مدى الأسبوع الماضي
                for (let i = 0; i < 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const dayData = this.data[dateStr];
                    if (dayData && dayData.checks) {
                        Object.keys(dayData.checks).forEach(key => {
                            if (key.startsWith(aspectId + '_')) {
                                total++;
                                if (dayData.checks[key]) completed++;
                            }
                        });
                    }
                }
                
                return total > 0 ? Math.round((completed / total) * 100) : 0;
            }

            generateInsights(stats) {
                const insights = [];
                
                if (stats.dailyScore >= 80) {
                    insights.push('أداء ممتاز اليوم! استمر في هذا المستوى.');
                } else if (stats.dailyScore >= 60) {
                    insights.push('يوم جيد، لكن هناك مجال للتحسين.');
                } else {
                    insights.push('اليوم يحتاج إلى مزيد من الجهد والتركيز.');
                }
                
                if (stats.consistency >= 80) {
                    insights.push('مستوى انتظام عالٍ، هذا رائع!');
                }
                
                if (stats.improvement > 0) {
                    insights.push(`تحسنت بنسبة ${stats.improvement}% عن الأسبوع الماضي.`);
                }
                
                return insights;
            }

            generateRecommendations(stats) {
                const recommendations = [];
                
                if (stats.weakAspects.length > 0) {
                    recommendations.push(`ركز على تحسين ${stats.weakAspects.map(a => a.name).join(' و ')}`);
                }
                
                if (stats.consistency < 70) {
                    recommendations.push('حاول أن تكون أكثر انتظاماً في أداء مهامك اليومية.');
                }
                
                if (stats.dailyScore < 70) {
                    recommendations.push('حدد أولوياتك بشكل أفضل في بداية اليوم.');
                }
                
                return recommendations;
            }

            updateTrends(stats) {
                const date = this.currentDate;
                if (!this.reviewResults.trends[date]) {
                    this.reviewResults.trends[date] = stats;
                }
            }

            getStreakDays() {
                // حساب عدد الأيام المتتالية
                let streak = 0;
                let currentDate = new Date();
                
                while (true) {
                    const dateStr = currentDate.toISOString().split('T')[0];
                    const dayData = this.data[dateStr];
                    
                    if (dayData && dayData.checks) {
                        const checks = Object.values(dayData.checks);
                        if (checks.length > 0) {
                            const completed = checks.filter(v => v).length;
                            if (completed >= checks.length * 0.7) {
                                streak++;
                                currentDate.setDate(currentDate.getDate() - 1);
                            } else {
                                break;
                            }
                        } else {
                            break;
                        }
                    } else {
                        break;
                    }
                }
                
                return streak;
            }

            getProductiveDaysThisMonth() {
                const monthId = this.getMonthId(new Date());
                const monthData = this.data[monthId] || {};
                return monthData.productiveDays || 0;
            }

            getWeekId(date) {
                const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
                d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
                const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
                const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
                return d.getUTCFullYear() + "-W" + weekNo;
            }

            getMonthId(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            }

            getCompletedDaysThisWeek() {
                return 4; // Mock data
            }

            getWeeklySuccessRate() {
                return 75; // Mock data
            }

            getMonthlyCompletionRate() {
                return 65; // Mock data
            }

            getGoalsCompletedThisMonth() {
                return 3; // Mock data
            }

            getMonthlyImprovement() {
                return 15; // Mock data
            }

            getMonthlyTaskCount() {
                return 42; // Mock data
            }

            getMonthlyHabitStreak() {
                return 28; // Mock data
            }

            getMonthlyProductivityScore() {
                return 84; // Mock data
            }

            getMonthlyConsistency() {
                return 78; // Mock data
            }
        }

        /* ===== 4. UI UTILITIES ===== */
        class UI {
            static toast(message, type = 'info', duration = 3000) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                
                toast.className = `toast ${type} animate-fade-in`;
                toast.innerHTML = `
                    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'alert-circle' : 'info'}" class="w-5 h-5"></i>
                    <span>${message}</span>
                `;
                
                container.appendChild(toast);
                lucide.createIcons();
                
                setTimeout(() => {
                    toast.style.animation = 'toastOut 0.3s forwards';
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }

            static modal(title, content, buttons = [], onClose = null) {
                const container = document.getElementById('modal-container');
                const modal = document.createElement('div');
                
                modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4 animate-fade-in';
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-hidden">
                        <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white">${title}</h3>
                            <button onclick="this.closest('.fixed').remove(); ${onClose ? onClose + '()' : ''}" 
                                    class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <div class="p-6 overflow-y-auto max-h-[60vh]">${content}</div>
                        ${buttons.length > 0 ? `
                            <div class="p-6 border-t border-gray-200 dark:border-gray-700 flex gap-2 justify-end">
                                ${buttons.map(btn => `
                                    <button onclick="${btn.onclick}" 
                                            class="px-4 py-2 rounded-lg font-medium ${btn.class}">
                                        ${btn.text}
                                    </button>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
                
                container.appendChild(modal);
                lucide.createIcons();
                return modal;
            }

            static confirm(message, onConfirm, onCancel = null) {
                this.modal('تأكيد', `
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                `, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700',
                        onclick: `this.closest('.fixed').remove(); ${onCancel ? onCancel() : ''}`
                    },
                    {
                        text: 'تأكيد',
                        class: 'bg-red-600 text-white hover:bg-red-700',
                        onclick: `this.closest('.fixed').remove(); ${onConfirm()}`
                    }
                ]);
            }

            static loading(show = true, message = 'جاري التحميل...') {
                const appContent = document.getElementById('app-content');
                if (show) {
                    appContent.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-64">
                            <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                            <p class="text-gray-600 dark:text-gray-400">${message}</p>
                        </div>
                    `;
                }
            }

            static updatePageTitle(title) {
                const titleEl = document.getElementById('current-page-title');
                if (titleEl) titleEl.textContent = title;
            }
        }

        /* ===== 5. VIEWS ===== */
        class Views {
            static dashboard() {
                const state = AppState.getInstance();
                const todayProgress = state.calculateTodayProgress();
                const activeGoals = state.getActiveGoals();
                const pendingTasks = state.getPendingTasks();
                const finance = state.finance;
                
                const totalIncome = finance.transactions?.filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + Number(t.amount), 0) || 0;
                const totalExpense = finance.transactions?.filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + Number(t.amount), 0) || 0;
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white">
                                    مرحباً، ${state.user?.name || 'مستخدم'} 👋
                                </h1>
                                <p class="text-gray-500 dark:text-gray-400 text-sm mt-1">نظامك الشامل للإنتاجية والتنظيم</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="glass-card px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2">
                                    <i data-lucide="calendar" class="w-4 h-4"></i> 
                                    ${new Date().toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                                </div>
                            </div>
                        </div>
                        
                        <!-- QUICK STATS -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="finance-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">إنجاز اليوم</p>
                                        <h3 class="text-2xl font-bold mt-1">${todayProgress}%</h3>
                                    </div>
                                    <div class="p-3 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
                                        <i data-lucide="check-circle" class="w-6 h-6 text-blue-600"></i>
                                    </div>
                                </div>
                                <div class="progress-bar mt-3">
                                    <div class="progress-fill" style="width: ${todayProgress}%"></div>
                                </div>
                            </div>
                            
                            <div class="finance-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">الأهداف النشطة</p>
                                        <h3 class="text-2xl font-bold mt-1">${activeGoals.length}</h3>
                                    </div>
                                    <div class="p-3 bg-green-100 dark:bg-green-900/50 rounded-lg">
                                        <i data-lucide="target" class="w-6 h-6 text-green-600"></i>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">${activeGoals.filter(g => g.priority === 'critical').length} أهداف حرجة</p>
                            </div>
                            
                            <div class="finance-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">الرصيد المالي</p>
                                        <h3 class="text-2xl font-bold mt-1">${(totalIncome - totalExpense).toLocaleString()} ₺</h3>
                                    </div>
                                    <div class="p-3 bg-purple-100 dark:bg-purple-900/50 rounded-lg">
                                        <i data-lucide="banknote" class="w-6 h-6 text-purple-600"></i>
                                    </div>
                                </div>
                                <div class="flex gap-2 text-xs mt-2">
                                    <span class="text-green-600">دخل ${totalIncome.toLocaleString()}</span>
                                    <span class="text-red-600">مصروف ${totalExpense.toLocaleString()}</span>
                                </div>
                            </div>
                            
                            <div class="finance-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">المهام المعلقة</p>
                                        <h3 class="text-2xl font-bold mt-1">${pendingTasks.length}</h3>
                                    </div>
                                    <div class="p-3 bg-orange-100 dark:bg-orange-900/50 rounded-lg">
                                        <i data-lucide="clipboard-list" class="w-6 h-6 text-orange-600"></i>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">${pendingTasks.filter(t => t.priority === 'critical').length} حرجة</p>
                            </div>
                        </div>
                        
                        <!-- MAIN CONTENT -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- LEFT COLUMN -->
                            <div class="lg:col-span-2 space-y-6">
                                <!-- TODAY'S TASKS -->
                                <div class="card">
                                    <div class="flex justify-between items-center mb-6">
                                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">مهام اليوم</h3>
                                        <button onclick="App.navigate('dailyTracker')" class="text-sm text-blue-600 hover:underline">
                                            عرض الكل →
                                        </button>
                                    </div>
                                    <div class="space-y-3">
                                        ${pendingTasks.slice(0, 5).map(task => `
                                            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                                <div class="flex items-center gap-3">
                                                    <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                                           class="custom-checkbox" 
                                                           onchange="App.toggleTaskCompletion('${task.id}', this.checked)">
                                                    <div>
                                                        <p class="font-medium ${task.completed ? 'line-through text-gray-400' : 'text-gray-700 dark:text-gray-300'}">
                                                            ${task.title}
                                                        </p>
                                                        <p class="text-xs text-gray-500">${task.category || 'عام'}</p>
                                                    </div>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    ${task.priority ? `
                                                        <span class="px-2 py-1 text-xs rounded-full priority-${task.priority}">
                                                            ${task.priority === 'critical' ? 'حرج' : task.priority === 'high' ? 'عالي' : 'متوسط'}
                                                        </span>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                        ${pendingTasks.length === 0 ? `
                                            <div class="text-center py-6 text-gray-500">
                                                <i data-lucide="check-circle" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                                                <p>لا توجد مهام لليوم</p>
                                                <button onclick="App.quickAction('task')" class="mt-2 text-blue-600 hover:underline">
                                                    إضافة مهمة جديدة
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                                
                                <!-- ACTIVE GOALS -->
                                <div class="card">
                                    <div class="flex justify-between items-center mb-6">
                                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">الأهداف النشطة</h3>
                                        <button onclick="App.navigate('advancedGoals')" class="text-sm text-blue-600 hover:underline">
                                            عرض الكل →
                                        </button>
                                    </div>
                                    <div class="space-y-4">
                                        ${activeGoals.slice(0, 3).map(goal => `
                                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-blue-300 transition-colors">
                                                <div class="flex justify-between items-start mb-2">
                                                    <h4 class="font-bold text-gray-800 dark:text-white">${goal.title}</h4>
                                                    <span class="px-2 py-1 text-xs rounded-full priority-${goal.priority}">
                                                        ${goal.priority === 'critical' ? 'حرج' : goal.priority === 'high' ? 'عالي' : 'متوسط'}
                                                    </span>
                                                </div>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">${goal.description || 'لا يوجد وصف'}</p>
                                                <div class="flex items-center justify-between">
                                                    <div class="flex-1">
                                                        <div class="progress-bar">
                                                            <div class="progress-fill" style="width: ${goal.progress || 0}%"></div>
                                                        </div>
                                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                                            <span>التقدم</span>
                                                            <span>${goal.progress || 0}%</span>
                                                        </div>
                                                    </div>
                                                    <span class="text-xs text-gray-500 mr-3">ينتهي ${new Date(goal.deadline).toLocaleDateString('ar-EG')}</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                        ${activeGoals.length === 0 ? `
                                            <div class="text-center py-6 text-gray-500">
                                                <i data-lucide="target" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                                                <p>لا توجد أهداف نشطة</p>
                                                <button onclick="App.quickAction('goal')" class="mt-2 text-blue-600 hover:underline">
                                                    إضافة هدف جديد
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- RIGHT COLUMN -->
                            <div class="space-y-6">
                                <!-- QUICK ACTIONS -->
                                <div class="card">
                                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">إجراءات سريعة</h3>
                                    <div class="grid grid-cols-2 gap-3">
                                        <button onclick="App.navigate('dailyTracker')" class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl flex flex-col items-center gap-2 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors">
                                            <i data-lucide="check-square" class="w-6 h-6 text-blue-600"></i>
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">متابعة اليوم</span>
                                        </button>
                                        <button onclick="App.navigate('journalManager')" class="p-4 bg-green-50 dark:bg-green-900/30 rounded-xl flex flex-col items-center gap-2 hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors">
                                            <i data-lucide="book-open" class="w-6 h-6 text-green-600"></i>
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">تدوين اليوم</span>
                                        </button>
                                        <button onclick="App.navigate('financeAdvanced')" class="p-4 bg-purple-50 dark:bg-purple-900/30 rounded-xl flex flex-col items-center gap-2 hover:bg-purple-100 dark:hover:bg-purple-900/50 transition-colors">
                                            <i data-lucide="trending-up" class="w-6 h-6 text-purple-600"></i>
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">تتبع المصروفات</span>
                                        </button>
                                        <button onclick="App.navigate('secureNotes')" class="p-4 bg-orange-50 dark:bg-orange-900/30 rounded-xl flex flex-col items-center gap-2 hover:bg-orange-100 dark:hover:bg-orange-900/50 transition-colors">
                                            <i data-lucide="lock" class="w-6 h-6 text-orange-600"></i>
                                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">ملاحظات آمنة</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- RECENT TRANSACTIONS -->
                                <div class="card">
                                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">آخر المعاملات</h3>
                                    <div class="space-y-3">
                                        ${finance.transactions?.slice(0, 3).map(transaction => `
                                            <div class="flex items-center justify-between p-2">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-8 h-8 rounded-full flex items-center justify-center ${transaction.type === 'income' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">
                                                        <i data-lucide="${transaction.type === 'income' ? 'arrow-down-right' : 'arrow-up-right'}" class="w-4 h-4"></i>
                                                    </div>
                                                    <div>
                                                        <p class="text-sm font-medium text-gray-700 dark:text-gray-300">${transaction.description}</p>
                                                        <p class="text-xs text-gray-500">${transaction.category}</p>
                                                    </div>
                                                </div>
                                                <span class="font-bold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                                    ${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toLocaleString()} ₺
                                                </span>
                                            </div>
                                        `).join('') || '<p class="text-sm text-gray-500 text-center py-4">لا توجد معاملات</p>'}
                                    </div>
                                </div>
                                
                                <!-- MOTIVATION -->
                                <div class="card bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20">
                                    <div class="flex items-start gap-3">
                                        <div class="p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
                                            <i data-lucide="sparkles" class="w-5 h-5 text-blue-600"></i>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-800 dark:text-white mb-1">حكمة اليوم</p>
                                            <p class="text-gray-600 dark:text-gray-300 text-sm">"النجاح ليس أن لا تسقط، بل أن تنهض كلما سقطت."</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static dailyTracker() {
                const state = AppState.getInstance();
                const aspects = state.config.aspects || [];
                const todayData = state.data[state.currentDate] || { checks: {}, notes: {}, metrics: {} };
                
                let totalTasks = 0;
                let completedTasks = 0;
                
                const rows = aspects.map(aspect => {
                    return aspect.daily.map((task, index) => {
                        const key = `${aspect.id}_${index}`;
                        const isChecked = todayData.checks?.[key] || false;
                        totalTasks++;
                        if (isChecked) completedTasks++;
                        
                        return `
                            <tr class="border-b border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                                <td class="py-3 px-2">
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 h-6 rounded flex items-center justify-center" style="background: ${aspect.color}20; color: ${aspect.color}">
                                            <i data-lucide="${aspect.icon}" class="w-3 h-3"></i>
                                        </div>
                                        <span class="font-bold text-sm">${aspect.name}</span>
                                    </div>
                                </td>
                                <td class="py-3 px-2 text-sm text-gray-700 dark:text-gray-300">${task}</td>
                                <td class="py-3 px-2 w-24">
                                    <label class="flex items-center gap-2 cursor-pointer select-none">
                                        <input type="checkbox" class="custom-checkbox" ${isChecked ? 'checked' : ''} 
                                               onchange="App.toggleDailyCheck('${key}', this.checked)">
                                        <span class="${isChecked ? 'line-through text-gray-400' : ''}">
                                            ${isChecked ? 'تم' : 'لم يتم'}
                                        </span>
                                    </label>
                                </td>
                                <td class="py-3 px-2">
                                    <input type="text" value="${todayData.notes?.[key] || ''}" placeholder="ملاحظة..." 
                                           class="notion-input text-sm" 
                                           onchange="App.saveDailyNote('${key}', this.value)">
                                </td>
                            </tr>
                        `;
                    }).join('');
                }).join('');
                
                const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                const isSuccessful = progress >= 70;
                const metrics = todayData.metrics || { energy: 3, focus: 3, mood: 3 };
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">📋 المتابعة اليومية</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">تابع تقدمك اليومي في جميع جوانب حياتك</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-bold ${isSuccessful ? 'text-green-600 bg-green-100 dark:bg-green-900/30' : 'text-gray-500 bg-gray-100 dark:bg-gray-800'} px-3 py-1 rounded-full">
                                        ${isSuccessful ? '✔ يوم ناجح' : '❌ يوم عادي'}
                                    </span>
                                    <span class="text-sm text-gray-500">${progress}% إنجاز</span>
                                </div>
                                <input type="date" value="${state.currentDate}" 
                                       onchange="App.changeDate(this.value)"
                                       class="notion-input text-sm w-auto">
                            </div>
                        </div>
                        
                        <!-- PROGRESS BAR -->
                        <div class="card">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">تقدم اليوم</h3>
                                <span class="text-2xl font-bold ${isSuccessful ? 'text-green-600' : 'text-blue-600'}">${progress}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ${isSuccessful ? 'bg-green-500' : 'bg-blue-500'}" style="width: ${progress}%"></div>
                            </div>
                            <div class="flex justify-between text-sm text-gray-500 mt-2">
                                <span>${completedTasks} من ${totalTasks} مكتملة</span>
                                <span>${isSuccessful ? '🎉 أحسنت!' : '💪 استمر!'}</span>
                            </div>
                        </div>
                        
                        <!-- TASKS TABLE -->
                        <div class="card overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-right">
                                    <thead class="bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-xs font-bold uppercase">
                                        <tr>
                                            <th class="py-3 px-2">الجانب</th>
                                            <th class="py-3 px-2">المهمة</th>
                                            <th class="py-3 px-2">الحالة</th>
                                            <th class="py-3 px-2">ملاحظات</th>
                                        </tr>
                                    </thead>
                                    <tbody>${rows}</tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- ENERGY METRICS -->
                        <div class="card">
                            <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📊 مقاييس الطاقة</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                ${['energy', 'focus', 'mood'].map(metric => `
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-medium text-gray-700 dark:text-gray-300">
                                                ${metric === 'energy' ? 'طاقتي' : metric === 'focus' ? 'تركيزي' : 'مزاجي'}
                                            </span>
                                            <span class="font-bold text-blue-600">${'⭐'.repeat(metrics[metric] || 3)}</span>
                                        </div>
                                        <input type="range" min="1" max="5" value="${metrics[metric] || 3}" 
                                               class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                               oninput="App.updateMetric('${metric}', this.value)">
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>منخفض</span>
                                            <span>متوسط</span>
                                            <span>مرتفع</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- DAILY NOTES -->
                        <div class="card">
                            <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📝 ملاحظات اليوم</h4>
                            <textarea id="daily-notes" class="notion-input h-32" 
                                      placeholder="اكتب ملاحظاتك اليومية هنا..."
                                      onchange="App.saveDailySummary(this.value)">${todayData.summary || ''}</textarea>
                        </div>
                        
                        <!-- ACTIONS -->
                        <div class="flex gap-3">
                            <button onclick="App.saveDailyProgress()" class="btn-primary flex-1 py-3">
                                <i data-lucide="save" class="w-5 h-5 inline ml-2"></i>
                                حفظ اليوم
                            </button>
                            <button onclick="App.resetDay()" class="px-6 py-3 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800">
                                إعادة تعيين
                            </button>
                        </div>
                    </div>
                `;
            }

            static weeklyReview() {
                const state = AppState.getInstance();
                const today = new Date();
                const weekId = state.getWeekId(today);
                const weekData = state.data[weekId] || {};
                const aspects = state.config.aspects || [];
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">📊 المراجعة الأسبوعية</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">راجع إنجازاتك الأسبوعية وخطط للأسبوع القادم</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="px-4 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg text-sm font-bold">
                                    الأسبوع ${weekId.split('-W')[1]}
                                </div>
                                <button onclick="App.generateWeeklyReport()" class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-800">
                                    تصدير التقرير
                                </button>
                            </div>
                        </div>
                        
                        <!-- WEEKLY OVERVIEW -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2">${state.getCompletedDaysThisWeek()}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">أيام مكتملة</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2">${state.getWeeklySuccessRate()}%</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">معدل النجاح</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-purple-600 mb-2">${state.getStreakDays()}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">أيام متتالية</p>
                            </div>
                        </div>
                        
                        <!-- WEEKLY TASKS -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">المهام الأسبوعية</h3>
                            <div class="space-y-4">
                                ${aspects.map(aspect => `
                                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                        <div class="flex items-center gap-2 mb-3">
                                            <div class="w-8 h-8 rounded flex items-center justify-center" style="background: ${aspect.color}20; color: ${aspect.color}">
                                                <i data-lucide="${aspect.icon}" class="w-4 h-4"></i>
                                            </div>
                                            <h4 class="font-bold text-gray-800 dark:text-white">${aspect.name}</h4>
                                        </div>
                                        <div class="space-y-2">
                                            ${aspect.weekly.map((task, index) => {
                                                const key = `${aspect.id}_w${index}`;
                                                const isChecked = weekData.checks?.[key] || false;
                                                return `
                                                    <label class="flex items-center gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg cursor-pointer">
                                                        <input type="checkbox" class="custom-checkbox" ${isChecked ? 'checked' : ''}
                                                               onchange="App.toggleWeeklyCheck('${key}', this.checked)">
                                                        <span class="${isChecked ? 'line-through text-gray-400' : 'text-gray-700 dark:text-gray-300'}">
                                                            ${task}
                                                        </span>
                                                    </label>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- WEEKLY REVIEW QUESTIONS -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- LEFT COLUMN -->
                            <div class="space-y-6">
                                <!-- ACHIEVEMENTS -->
                                <div class="card">
                                    <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">🏆 إنجازات الأسبوع</h4>
                                    <textarea id="weekly-achievements" class="notion-input h-32"
                                              placeholder="ما هي إنجازاتك هذا الأسبوع؟"
                                              onchange="App.saveWeeklyData('achievements', this.value)">${weekData.achievements || ''}</textarea>
                                </div>
                                
                                <!-- CHALLENGES -->
                                <div class="card">
                                    <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">⚡ التحديات والصعوبات</h4>
                                    <textarea id="weekly-challenges" class="notion-input h-32"
                                              placeholder="ما هي التحديات التي واجهتها؟"
                                              onchange="App.saveWeeklyData('challenges', this.value)">${weekData.challenges || ''}</textarea>
                                </div>
                            </div>
                            
                            <!-- RIGHT COLUMN -->
                            <div class="space-y-6">
                                <!-- LEARNINGS -->
                                <div class="card">
                                    <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📚 الدروس المستفادة</h4>
                                    <textarea id="weekly-learnings" class="notion-input h-32"
                                              placeholder="ما هي الدروس التي تعلمتها هذا الأسبوع؟"
                                              onchange="App.saveWeeklyData('learnings', this.value)">${weekData.learnings || ''}</textarea>
                                </div>
                                
                                <!-- NEXT WEEK FOCUS -->
                                <div class="card">
                                    <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">🎯 تركيز الأسبوع القادم</h4>
                                    <textarea id="weekly-focus" class="notion-input h-32"
                                              placeholder="ما هي أولوياتك للأسبوع القادم؟"
                                              onchange="App.saveWeeklyData('nextFocus', this.value)">${weekData.nextFocus || ''}</textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- WEEKLY RATING -->
                        <div class="card">
                            <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">⭐ تقييم الأسبوع</h4>
                            <div class="flex items-center gap-4">
                                <div class="flex-1">
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-2">كيف تقيم أداءك هذا الأسبوع؟</label>
                                    <div class="flex gap-1">
                                        ${[1, 2, 3, 4, 5].map(star => `
                                            <button onclick="App.setWeeklyRating(${star})" 
                                                    class="text-2xl ${star <= (weekData.rating || 0) ? 'text-yellow-400' : 'text-gray-300'} hover:text-yellow-300">
                                                ★
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="text-3xl font-bold text-blue-600">${weekData.rating || 0}/5</div>
                            </div>
                        </div>
                        
                        <!-- SAVE BUTTON -->
                        <button onclick="App.saveWeeklyReview()" class="w-full btn-primary py-3">
                            <i data-lucide="save" class="w-5 h-5 inline ml-2"></i>
                            حفظ المراجعة الأسبوعية
                        </button>
                    </div>
                `;
            }

            static monthlyReview() {
                const state = AppState.getInstance();
                const today = new Date();
                const monthId = state.getMonthId(today);
                const monthData = state.data[monthId] || {};
                const aspects = state.config.aspects || [];
                const monthNames = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];
                const [year, month] = monthId.split('-');
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">📈 المراجعة الشهرية</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">نظرة شاملة على إنجازاتك وتطورك خلال الشهر</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="px-4 py-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 rounded-lg text-sm font-bold">
                                    ${monthNames[parseInt(month) - 1]} ${year}
                                </div>
                                <button onclick="App.generateMonthlyReport()" class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-800">
                                    تصدير التقرير
                                </button>
                            </div>
                        </div>
                        
                        <!-- MONTHLY OVERVIEW -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2">${state.getMonthlyCompletionRate()}%</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">إنجاز الشهر</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2">${state.getGoalsCompletedThisMonth()}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">أهداف مكتملة</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-orange-600 mb-2">${state.getProductiveDaysThisMonth()}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">أيام منتجة</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-purple-600 mb-2">${state.getMonthlyImprovement()}%</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">تحسن عن الشهر الماضي</p>
                            </div>
                        </div>
                        
                        <!-- MONTHLY TASKS -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">المهام الشهرية</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${aspects.map(aspect => `
                                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                        <div class="flex items-center gap-2 mb-3">
                                            <div class="w-8 h-8 rounded flex items-center justify-center" style="background: ${aspect.color}20; color: ${aspect.color}">
                                                <i data-lucide="${aspect.icon}" class="w-4 h-4"></i>
                                            </div>
                                            <h4 class="font-bold text-gray-800 dark:text-white">${aspect.name}</h4>
                                        </div>
                                        <div class="space-y-2">
                                            ${aspect.monthly.map((task, index) => {
                                                const key = `${aspect.id}_m${index}`;
                                                const isChecked = monthData.checks?.[key] || false;
                                                return `
                                                    <label class="flex items-center gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg cursor-pointer">
                                                        <input type="checkbox" class="custom-checkbox" ${isChecked ? 'checked' : ''}
                                                               onchange="App.toggleMonthlyCheck('${key}', this.checked)">
                                                        <span class="${isChecked ? 'line-through text-gray-400' : 'text-gray-700 dark:text-gray-300'}">
                                                            ${task}
                                                        </span>
                                                    </label>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- MONTHLY REVIEW -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- ACHIEVEMENTS & CHALLENGES -->
                            <div class="space-y-6">
                                <div class="card">
                                    <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">🏆 أهم الإنجازات</h4>
                                    <textarea id="monthly-achievements" class="notion-input h-40"
                                              placeholder="ما هي أهم إنجازاتك هذا الشهر؟"
                                              onchange="App.saveMonthlyData('achievements', this.value)">${monthData.achievements || ''}</textarea>
                                </div>
                                <div class="card">
                                    <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">⚡ التحديات الرئيسية</h4>
                                    <textarea id="monthly-challenges" class="notion-input h-40"
                                              placeholder="ما هي أكبر التحديات التي واجهتها؟"
                                              onchange="App.saveMonthlyData('challenges', this.value)">${monthData.challenges || ''}</textarea>
                                </div>
                            </div>
                            
                            <!-- LEARNINGS & NEXT MONTH -->
                            <div class="space-y-6">
                                <div class="card">
                                    <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📚 أهم الدروس</h4>
                                    <textarea id="monthly-learnings" class="notion-input h-40"
                                              placeholder="ما هي أهم الدروس التي تعلمتها هذا الشهر؟"
                                              onchange="App.saveMonthlyData('learnings', this.value)">${monthData.learnings || ''}</textarea>
                                </div>
                                <div class="card">
                                    <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">🎯 أهداف الشهر القادم</h4>
                                    <textarea id="monthly-next-goals" class="notion-input h-40"
                                              placeholder="ما هي أهدافك للشهر القادم؟"
                                              onchange="App.saveMonthlyData('nextGoals', this.value)">${monthData.nextGoals || ''}</textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- MONTHLY STATS -->
                        <div class="card">
                            <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📊 إحصائيات الشهر</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                    <div class="text-2xl font-bold text-blue-600">${state.getMonthlyTaskCount()}</div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">مهمة مكتملة</p>
                                </div>
                                <div class="text-center p-4 bg-green-50 dark:bg-green-900/30 rounded-lg">
                                    <div class="text-2xl font-bold text-green-600">${state.getMonthlyHabitStreak()}</div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">أيام متتالية</p>
                                </div>
                                <div class="text-center p-4 bg-purple-50 dark:bg-purple-900/30 rounded-lg">
                                    <div class="text-2xl font-bold text-purple-600">${state.getMonthlyProductivityScore()}</div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">معدل إنتاجية</p>
                                </div>
                                <div class="text-center p-4 bg-orange-50 dark:bg-orange-900/30 rounded-lg">
                                    <div class="text-2xl font-bold text-orange-600">${state.getMonthlyConsistency()}%</div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">اتساق</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SAVE BUTTON -->
                        <button onclick="App.saveMonthlyReview()" class="w-full btn-primary py-3">
                            <i data-lucide="save" class="w-5 h-5 inline ml-2"></i>
                            حفظ المراجعة الشهرية
                        </button>
                    </div>
                `;
            }

            static reviewResults() {
                const state = AppState.getInstance();
                const summaries = state.reviewResults.summaries || [];
                const latestSummary = summaries.length > 0 ? summaries[0] : null;
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">📊 نتائج المراجعات</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">تحليل متقدم لإنجازاتك وتطورك عبر الزمن</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <button onclick="App.generateNewReview()" class="btn-primary px-4 py-2">
                                    <i data-lucide="refresh-cw" class="w-5 h-5 inline ml-2"></i>
                                    توليد تقرير جديد
                                </button>
                                <button onclick="App.exportReviewResults()" class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-800">
                                    <i data-lucide="download" class="w-5 h-5 inline ml-2"></i>
                                    تصدير النتائج
                                </button>
                            </div>
                        </div>
                        
                        <!-- QUICK STATS -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2">${state.calculateTodayProgress()}%</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">إنجاز اليوم</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2">${state.getStreakDays()}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">أيام متتالية</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-purple-600 mb-2">${state.calculateConsistency()}%</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">معدل الانتظام</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-orange-600 mb-2">${state.calculateImprovement() >= 0 ? '+' : ''}${state.calculateImprovement()}%</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">تحسن عن الأسبوع الماضي</p>
                            </div>
                        </div>
                        
                        <!-- LATEST SUMMARY -->
                        ${latestSummary ? `
                            <div class="card bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="font-bold text-lg text-gray-900 dark:text-white">📈 ملخص أدائك الأخير</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">${new Date(latestSummary.createdAt).toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                    </div>
                                    <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300 rounded-full text-sm">
                                        ${latestSummary.period === 'daily' ? 'يومي' : latestSummary.period === 'weekly' ? 'أسبوعي' : 'شهري'}
                                    </span>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-bold text-gray-700 dark:text-gray-300 mb-3">🎯 النتائج الرئيسية</h4>
                                        <div class="space-y-3">
                                            <div class="flex justify-between items-center">
                                                <span>التقييم اليومي</span>
                                                <span class="font-bold ${latestSummary.scores.dailyScore >= 70 ? 'text-green-600' : 'text-orange-600'}">
                                                    ${latestSummary.scores.dailyScore}%
                                                </span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span>أفضل الجوانب</span>
                                                <div class="flex gap-2">
                                                    ${latestSummary.scores.topPerformingAspects.map(aspect => `
                                                        <span class="px-2 py-1 bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-300 rounded text-xs">
                                                            ${aspect.name}
                                                        </span>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4 class="font-bold text-gray-700 dark:text-gray-300 mb-3">💡 رؤى وتوصيات</h4>
                                        <div class="space-y-2">
                                            ${latestSummary.insights.map(insight => `
                                                <div class="flex items-start gap-2">
                                                    <i data-lucide="lightbulb" class="w-4 h-4 text-yellow-500 mt-0.5"></i>
                                                    <span class="text-sm">${insight}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- REVIEWS TABLE -->
                        <div class="card">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">سجلات المراجعات</h3>
                                <div class="flex gap-2">
                                    <select id="review-period-filter" class="notion-input text-sm w-auto" onchange="App.filterReviews(this.value)">
                                        <option value="all">جميع الفترات</option>
                                        <option value="daily">يومية</option>
                                        <option value="weekly">أسبوعية</option>
                                        <option value="monthly">شهرية</option>
                                    </select>
                                    <input type="date" id="review-date-filter" class="notion-input text-sm w-auto" onchange="App.filterByDate(this.value)">
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full text-right">
                                    <thead class="bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-xs font-bold uppercase">
                                        <tr>
                                            <th class="py-3 px-4">التاريخ</th>
                                            <th class="py-3 px-4">الفترة</th>
                                            <th class="py-3 px-4">التقييم</th>
                                            <th class="py-3 px-4">الانتظام</th>
                                            <th class="py-3 px-4">أفضل جوانب</th>
                                            <th class="py-3 px-4">الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${summaries.length > 0 ? summaries.map((summary, index) => `
                                            <tr class="border-b border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800">
                                                <td class="py-3 px-4">
                                                    ${new Date(summary.createdAt).toLocaleDateString('ar-EG')}
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="px-2 py-1 rounded-full text-xs ${summary.period === 'daily' ? 'bg-blue-100 text-blue-600' : summary.period === 'weekly' ? 'bg-green-100 text-green-600' : 'bg-purple-100 text-purple-600'}">
                                                        ${summary.period === 'daily' ? 'يومي' : summary.period === 'weekly' ? 'أسبوعي' : 'شهري'}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <div class="flex items-center gap-2">
                                                        <div class="progress-bar w-24">
                                                            <div class="progress-fill ${summary.scores.dailyScore >= 70 ? 'bg-green-500' : 'bg-orange-500'}" 
                                                                 style="width: ${summary.scores.dailyScore}%"></div>
                                                        </div>
                                                        <span class="font-bold">${summary.scores.dailyScore}%</span>
                                                    </div>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="font-bold ${summary.scores.consistency >= 70 ? 'text-green-600' : 'text-orange-600'}">
                                                        ${summary.scores.consistency}%
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <div class="flex gap-1 flex-wrap">
                                                        ${summary.scores.topPerformingAspects.slice(0, 2).map(aspect => `
                                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">
                                                                ${aspect.name}
                                                            </span>
                                                        `).join('')}
                                                    </div>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <div class="flex gap-2">
                                                        <button onclick="App.viewReviewDetails('${summary.id}')" class="p-1 text-blue-600 hover:text-blue-800" title="عرض التفاصيل">
                                                            <i data-lucide="eye" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.editReviewSummary('${summary.id}')" class="p-1 text-green-600 hover:text-green-800" title="تعديل">
                                                            <i data-lucide="edit" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.deleteReviewSummary('${summary.id}')" class="p-1 text-red-600 hover:text-red-800" title="حذف">
                                                            <i data-lucide="trash" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.exportReviewSummary('${summary.id}')" class="p-1 text-purple-600 hover:text-purple-800" title="تصدير">
                                                            <i data-lucide="download" class="w-4 h-4"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('') : `
                                            <tr>
                                                <td colspan="6" class="py-8 text-center text-gray-500">
                                                    <i data-lucide="bar-chart-3" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                                                    <p>لا توجد سجلات مراجعات بعد</p>
                                                    <button onclick="App.generateNewReview()" class="mt-2 text-blue-600 hover:underline">
                                                        إنشاء أول تقرير مراجعة
                                                    </button>
                                                </td>
                                            </tr>
                                        `}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- PAGINATION -->
                            ${summaries.length > 0 ? `
                                <div class="flex justify-between items-center mt-6">
                                    <div class="text-sm text-gray-500">
                                        عرض 1-${Math.min(summaries.length, 10)} من ${summaries.length} سجل
                                    </div>
                                    <div class="flex gap-1">
                                        <button class="px-3 py-1 border border-gray-300 dark:border-gray-700 rounded text-sm hover:bg-gray-50 dark:hover:bg-gray-800">
                                            السابق
                                        </button>
                                        <button class="px-3 py-1 bg-blue-600 text-white rounded text-sm">1</button>
                                        <button class="px-3 py-1 border border-gray-300 dark:border-gray-700 rounded text-sm hover:bg-gray-50 dark:hover:bg-gray-800">
                                            التالي
                                        </button>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <!-- CHARTS AND ANALYTICS -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- PERFORMANCE TREND -->
                            <div class="card">
                                <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📈 اتجاه الأداء</h4>
                                <div class="h-64 flex items-center justify-center">
                                    <canvas id="performanceTrendChart"></canvas>
                                </div>
                            </div>
                            
                            <!-- ASPECTS COMPARISON -->
                            <div class="card">
                                <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">⚖️ مقارنة الجوانب</h4>
                                <div class="h-64 flex items-center justify-center">
                                    <canvas id="aspectsComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- INSIGHTS AND RECOMMENDATIONS -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- INSIGHTS -->
                            <div class="card">
                                <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">💡 رؤى مهمة</h4>
                                <div class="space-y-3">
                                    ${state.getTopPerformingAspects().length > 0 ? `
                                        <div class="flex items-start gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                            <i data-lucide="award" class="w-5 h-5 text-green-600 mt-0.5"></i>
                                            <div>
                                                <p class="font-medium text-green-700 dark:text-green-300">أفضل أداء</p>
                                                <p class="text-sm text-green-600 dark:text-green-400">
                                                    ${state.getTopPerformingAspects().map(a => a.name).join('، ')}
                                                </p>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    ${state.getWeakAspects().length > 0 ? `
                                        <div class="flex items-start gap-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                            <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600 mt-0.5"></i>
                                            <div>
                                                <p class="font-medium text-orange-700 dark:text-orange-300">تحتاج تحسين</p>
                                                <p class="text-sm text-orange-600 dark:text-orange-400">
                                                    ${state.getWeakAspects().map(a => a.name).join('، ')}
                                                </p>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    <div class="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                        <i data-lucide="trending-up" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                                        <div>
                                            <p class="font-medium text-blue-700 dark:text-blue-300">الاتجاه</p>
                                            <p class="text-sm text-blue-600 dark:text-blue-400">
                                                ${state.calculateImprovement() >= 0 ? 'في تحسن مستمر' : 'بحاجة إلى تركيز أكبر'}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- RECOMMENDATIONS -->
                            <div class="card">
                                <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">🎯 توصيات للتحسين</h4>
                                <div class="space-y-3">
                                    ${state.generateRecommendations({
                                        weakAspects: state.getWeakAspects(),
                                        consistency: state.calculateConsistency(),
                                        dailyScore: state.calculateTodayProgress()
                                    }).map(rec => `
                                        <div class="flex items-start gap-3">
                                            <i data-lucide="check-circle" class="w-5 h-5 text-green-500 mt-0.5"></i>
                                            <p class="text-sm">${rec}</p>
                                        </div>
                                    `).join('')}
                                    
                                    <div class="mt-4 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                        <p class="text-sm font-medium text-purple-700 dark:text-purple-300">نصيحة اليوم:</p>
                                        <p class="text-sm text-purple-600 dark:text-purple-400 mt-1">
                                            ركز على إنجاز أهم ثلاث مهام في بداية يومك لتحقيق النجاح.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- EXPORT OPTIONS -->
                        <div class="card">
                            <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📤 خيارات التصدير</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button onclick="App.exportToPDF()" class="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg flex flex-col items-center gap-2 hover:bg-red-100 dark:hover:bg-red-900/30">
                                    <i data-lucide="file-text" class="w-6 h-6 text-red-600"></i>
                                    <span class="text-sm font-medium">PDF</span>
                                </button>
                                <button onclick="App.exportToExcel()" class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg flex flex-col items-center gap-2 hover:bg-green-100 dark:hover:bg-green-900/30">
                                    <i data-lucide="table" class="w-6 h-6 text-green-600"></i>
                                    <span class="text-sm font-medium">Excel</span>
                                </button>
                                <button onclick="App.exportToJSON()" class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex flex-col items-center gap-2 hover:bg-blue-100 dark:hover:bg-blue-900/30">
                                    <i data-lucide="code" class="w-6 h-6 text-blue-600"></i>
                                    <span class="text-sm font-medium">JSON</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            static aspectsEditor() {
                const state = AppState.getInstance();
                const aspects = state.config.aspects || [];
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">⚙️ إدارة الجوانب</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">قم بتخصيص جوانب حياتك ومهامك اليومية والأسبوعية والشهرية</p>
                            </div>
                            <button onclick="App.addNewAspect()" class="btn-primary px-4 py-2">
                                <i data-lucide="plus" class="w-5 h-5 inline ml-2"></i>
                                إضافة جانب جديد
                            </button>
                        </div>
                        
                        <!-- ASPECTS LIST -->
                        <div class="space-y-4">
                            ${aspects.map((aspect, index) => `
                                <div class="card">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: ${aspect.color}20; color: ${aspect.color}">
                                                <i data-lucide="${aspect.icon}" class="w-5 h-5"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">${aspect.name}</h3>
                                                <p class="text-sm text-gray-500">${aspect.daily.length} يومي | ${aspect.weekly.length} أسبوعي | ${aspect.monthly.length} شهري</p>
                                            </div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="App.editAspect(${index})" class="p-2 text-gray-400 hover:text-blue-600">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="App.deleteAspect(${index})" class="p-2 text-gray-400 hover:text-red-600">
                                                <i data-lucide="trash" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- DAILY TASKS -->
                                    <div class="mb-4">
                                        <div class="flex justify-between items-center mb-2">
                                            <h4 class="font-bold text-sm text-gray-600 dark:text-gray-400">المهام اليومية</h4>
                                            <button onclick="App.addTaskToAspect(${index}, 'daily')" class="text-xs text-blue-600 hover:underline">
                                                + إضافة
                                            </button>
                                        </div>
                                        <div class="space-y-2">
                                            ${aspect.daily.map((task, taskIndex) => `
                                                <div class="flex items-center gap-2">
                                                    <input type="text" value="${task}" 
                                                           class="notion-input text-sm flex-1"
                                                           onchange="App.updateAspectTask(${index}, 'daily', ${taskIndex}, this.value)">
                                                    <button onclick="App.removeTaskFromAspect(${index}, 'daily', ${taskIndex})" 
                                                            class="p-1 text-gray-300 hover:text-red-500">
                                                        <i data-lucide="x" class="w-4 h-4"></i>
                                                    </button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    
                                    <!-- WEEKLY TASKS -->
                                    <div class="mb-4">
                                        <div class="flex justify-between items-center mb-2">
                                            <h4 class="font-bold text-sm text-gray-600 dark:text-gray-400">المهام الأسبوعية</h4>
                                            <button onclick="App.addTaskToAspect(${index}, 'weekly')" class="text-xs text-blue-600 hover:underline">
                                                + إضافة
                                            </button>
                                        </div>
                                        <div class="space-y-2">
                                            ${aspect.weekly.map((task, taskIndex) => `
                                                <div class="flex items-center gap-2">
                                                    <input type="text" value="${task}" 
                                                           class="notion-input text-sm flex-1"
                                                           onchange="App.updateAspectTask(${index}, 'weekly', ${taskIndex}, this.value)">
                                                    <button onclick="App.removeTaskFromAspect(${index}, 'weekly', ${taskIndex})" 
                                                            class="p-1 text-gray-300 hover:text-red-500">
                                                        <i data-lucide="x" class="w-4 h-4"></i>
                                                    </button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    
                                    <!-- MONTHLY TASKS -->
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <h4 class="font-bold text-sm text-gray-600 dark:text-gray-400">المهام الشهرية</h4>
                                            <button onclick="App.addTaskToAspect(${index}, 'monthly')" class="text-xs text-blue-600 hover:underline">
                                                + إضافة
                                            </button>
                                        </div>
                                        <div class="space-y-2">
                                            ${aspect.monthly.map((task, taskIndex) => `
                                                <div class="flex items-center gap-2">
                                                    <input type="text" value="${task}" 
                                                           class="notion-input text-sm flex-1"
                                                           onchange="App.updateAspectTask(${index}, 'monthly', ${taskIndex}, this.value)">
                                                    <button onclick="App.removeTaskFromAspect(${index}, 'monthly', ${taskIndex})" 
                                                            class="p-1 text-gray-300 hover:text-red-500">
                                                        <i data-lucide="x" class="w-4 h-4"></i>
                                                    </button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- EMPTY STATE -->
                        ${aspects.length === 0 ? `
                            <div class="card text-center py-12">
                                <i data-lucide="layers" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                                <h3 class="text-lg font-bold text-gray-700 dark:text-gray-300 mb-2">لا توجد جوانب بعد</h3>
                                <p class="text-gray-500 mb-6">ابدأ بإضافة أول جانب لتتمكن من متابعة تقدمك</p>
                                <button onclick="App.addNewAspect()" class="btn-primary px-6 py-3">
                                    <i data-lucide="plus" class="w-5 h-5 inline ml-2"></i>
                                    إضافة أول جانب
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            static advancedGoals() {
                const state = AppState.getInstance();
                const goals = state.goals || [];
                const categories = state.config.categories?.goals || ['مهني', 'شخصي', 'صحي', 'مالي', 'تعليمي', 'روحي', 'اجتماعي'];
                
                // تصنيف الأهداف حسب الحالة
                const activeGoals = goals.filter(g => g.status === 'active');
                const completedGoals = goals.filter(g => g.status === 'completed');
                const overdueGoals = goals.filter(g => new Date(g.deadline) < new Date() && g.status !== 'completed');
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">🎯 الأهداف المتقدمة</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">إدارة أهدافك الذكية (SMART) مع تتبع متقدم</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <button onclick="App.showGoalFilters()" class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-800">
                                    <i data-lucide="filter" class="w-5 h-5 inline ml-2"></i>
                                    تصفية
                                </button>
                                <button onclick="App.addNewGoal()" class="btn-primary px-4 py-2">
                                    <i data-lucide="plus" class="w-5 h-5 inline ml-2"></i>
                                    هدف جديد
                                </button>
                            </div>
                        </div>
                        
                        <!-- GOALS STATS -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2">${goals.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">إجمالي الأهداف</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2">${activeGoals.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">نشطة</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-purple-600 mb-2">${completedGoals.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">مكتملة</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-red-600 mb-2">${overdueGoals.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">متأخرة</p>
                            </div>
                        </div>
                        
                        <!-- GOALS KANBAN BOARD -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">لوحة الأهداف (Kanban)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <!-- TODO -->
                                <div class="kanban-column" data-status="todo">
                                    <div class="flex items-center gap-2 mb-4">
                                        <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
                                        <h4 class="font-bold text-gray-700 dark:text-gray-300">قيد الانتظار</h4>
                                        <span class="ml-auto bg-gray-100 dark:bg-gray-800 text-gray-600 text-xs px-2 py-1 rounded">${goals.filter(g => g.status === 'pending').length}</span>
                                    </div>
                                    ${goals.filter(g => g.status === 'pending').map(goal => this.renderGoalCard(goal)).join('')}
                                </div>
                                
                                <!-- IN PROGRESS -->
                                <div class="kanban-column" data-status="in-progress">
                                    <div class="flex items-center gap-2 mb-4">
                                        <div class="w-3 h-3 bg-blue-400 rounded-full"></div>
                                        <h4 class="font-bold text-gray-700 dark:text-gray-300">قيد التنفيذ</h4>
                                        <span class="ml-auto bg-blue-100 dark:bg-blue-900 text-blue-600 text-xs px-2 py-1 rounded">${goals.filter(g => g.status === 'active').length}</span>
                                    </div>
                                    ${goals.filter(g => g.status === 'active').map(goal => this.renderGoalCard(goal)).join('')}
                                </div>
                                
                                <!-- REVIEW -->
                                <div class="kanban-column" data-status="review">
                                    <div class="flex items-center gap-2 mb-4">
                                        <div class="w-3 h-3 bg-yellow-400 rounded-full"></div>
                                        <h4 class="font-bold text-gray-700 dark:text-gray-300">قيد المراجعة</h4>
                                        <span class="ml-auto bg-yellow-100 dark:bg-yellow-900 text-yellow-600 text-xs px-2 py-1 rounded">${goals.filter(g => g.status === 'review').length}</span>
                                    </div>
                                    ${goals.filter(g => g.status === 'review').map(goal => this.renderGoalCard(goal)).join('')}
                                </div>
                                
                                <!-- COMPLETED -->
                                <div class="kanban-column" data-status="completed">
                                    <div class="flex items-center gap-2 mb-4">
                                        <div class="w-3 h-3 bg-green-400 rounded-full"></div>
                                        <h4 class="font-bold text-gray-700 dark:text-gray-300">مكتملة</h4>
                                        <span class="ml-auto bg-green-100 dark:bg-green-900 text-green-600 text-xs px-2 py-1 rounded">${completedGoals.length}</span>
                                    </div>
                                    ${completedGoals.slice(0, 5).map(goal => this.renderGoalCard(goal)).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- GOALS TABLE -->
                        <div class="card">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">قائمة الأهداف</h3>
                                <div class="flex gap-2">
                                    <select id="goal-category-filter" class="notion-input text-sm w-auto" onchange="App.filterGoalsByCategory(this.value)">
                                        <option value="all">جميع الفئات</option>
                                        ${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                                    </select>
                                    <select id="goal-priority-filter" class="notion-input text-sm w-auto" onchange="App.filterGoalsByPriority(this.value)">
                                        <option value="all">جميع الأولويات</option>
                                        <option value="critical">حرجة</option>
                                        <option value="high">عالية</option>
                                        <option value="medium">متوسطة</option>
                                        <option value="low">منخفضة</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full text-right">
                                    <thead class="bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-xs font-bold uppercase">
                                        <tr>
                                            <th class="py-3 px-4">الهدف</th>
                                            <th class="py-3 px-4">النوع</th>
                                            <th class="py-3 px-4">الأولوية</th>
                                            <th class="py-3 px-4">التقدم</th>
                                            <th class="py-3 px-4">الموعد النهائي</th>
                                            <th class="py-3 px-4">الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${goals.length > 0 ? goals.map(goal => `
                                            <tr class="border-b border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800">
                                                <td class="py-3 px-4">
                                                    <div class="flex items-center gap-3">
                                                        <input type="checkbox" ${goal.status === 'completed' ? 'checked' : ''} 
                                                               class="custom-checkbox"
                                                               onchange="App.toggleGoalCompletion('${goal.id}', this.checked)">
                                                        <div>
                                                            <p class="font-medium text-gray-700 dark:text-gray-300">${goal.title}</p>
                                                            <p class="text-xs text-gray-500">${goal.description?.substring(0, 50)}...</p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">
                                                        ${goal.category || 'عام'}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="px-2 py-1 rounded-full text-xs priority-${goal.priority}">
                                                        ${goal.priority === 'critical' ? 'حرج' : 
                                                          goal.priority === 'high' ? 'عالي' : 
                                                          goal.priority === 'medium' ? 'متوسط' : 'منخفض'}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <div class="flex items-center gap-2">
                                                        <div class="progress-bar w-24">
                                                            <div class="progress-fill" style="width: ${goal.progress || 0}%"></div>
                                                        </div>
                                                        <span class="text-sm font-bold">${goal.progress || 0}%</span>
                                                    </div>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="${new Date(goal.deadline) < new Date() && goal.status !== 'completed' ? 'text-red-600 font-bold' : 'text-gray-600'}">
                                                        ${new Date(goal.deadline).toLocaleDateString('ar-EG')}
                                                        ${new Date(goal.deadline) < new Date() && goal.status !== 'completed' ? '⏰' : ''}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <div class="flex gap-2">
                                                        <button onclick="App.viewGoalDetails('${goal.id}')" class="p-1 text-blue-600 hover:text-blue-800">
                                                            <i data-lucide="eye" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.editGoal('${goal.id}')" class="p-1 text-green-600 hover:text-green-800">
                                                            <i data-lucide="edit" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.deleteGoal('${goal.id}')" class="p-1 text-red-600 hover:text-red-800">
                                                            <i data-lucide="trash" class="w-4 h-4"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('') : `
                                            <tr>
                                                <td colspan="6" class="py-8 text-center text-gray-500">
                                                    <i data-lucide="target" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                                                    <p>لا توجد أهداف بعد</p>
                                                    <button onclick="App.addNewGoal()" class="mt-2 text-blue-600 hover:underline">
                                                        إضافة أول هدف
                                                    </button>
                                                </td>
                                            </tr>
                                        `}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- GOAL ACTIONS -->
                            <div class="flex justify-between items-center mt-6">
                                <div class="text-sm text-gray-500">
                                    عرض ${goals.length} هدف
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="App.exportGoals()" class="px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-800">
                                        تصدير الأهداف
                                    </button>
                                    <button onclick="App.bulkGoalActions()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">
                                        إجراءات جماعية
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- GOAL INSIGHTS -->
                        <div class="card">
                            <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📈 تحليلات الأهداف</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-bold text-gray-700 dark:text-gray-300 mb-3">معدل إنجاز الأهداف</h5>
                                    <div class="h-48">
                                        <canvas id="goalCompletionChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-bold text-gray-700 dark:text-gray-300 mb-3">توزيع الأهداف حسب الفئة</h5>
                                    <div class="h-48">
                                        <canvas id="goalCategoryChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static renderGoalCard(goal) {
                return `
                    <div class="kanban-card" draggable="true" data-id="${goal.id}" ondragstart="App.startDragGoal(event)">
                        <div class="flex justify-between items-start mb-2">
                            <h5 class="font-bold text-sm text-gray-800 dark:text-white">${goal.title}</h5>
                            <span class="text-xs px-2 py-1 rounded-full priority-${goal.priority}">
                                ${goal.priority === 'critical' ? 'حرج' : goal.priority === 'high' ? 'عالي' : 'متوسط'}
                            </span>
                        </div>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-3 truncate">${goal.description || 'لا يوجد وصف'}</p>
                        <div class="flex justify-between items-center">
                            <div class="progress-bar w-full">
                                <div class="progress-fill" style="width: ${goal.progress || 0}%"></div>
                            </div>
                            <span class="text-xs font-bold ml-2">${goal.progress || 0}%</span>
                        </div>
                        <div class="flex justify-between items-center mt-3">
                            <span class="text-xs text-gray-500">${new Date(goal.deadline).toLocaleDateString('ar-EG')}</span>
                            <div class="flex gap-1">
                                <button onclick="App.viewGoalDetails('${goal.id}')" class="p-1 text-gray-400 hover:text-blue-600">
                                    <i data-lucide="eye" class="w-3 h-3"></i>
                                </button>
                                <button onclick="App.editGoal('${goal.id}')" class="p-1 text-gray-400 hover:text-green-600">
                                    <i data-lucide="edit" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            static financeAdvanced() {
                const state = AppState.getInstance();
                const finance = state.finance;
                const transactions = finance.transactions || [];
                const budgets = finance.budgets || [];
                const savingsGoals = finance.goals || [];
                
                const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const balance = totalIncome - totalExpense;
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">💰 المالية المتقدمة</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">إدارة ميزانيتك واستثماراتك وأهدافك المالية</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <button onclick="App.addTransaction()" class="btn-primary px-4 py-2">
                                    <i data-lucide="plus" class="w-5 h-5 inline ml-2"></i>
                                    إضافة معاملة
                                </button>
                            </div>
                        </div>
                        
                        <!-- FINANCIAL OVERVIEW -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="finance-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">إجمالي الدخل</p>
                                        <h3 class="text-2xl font-bold mt-1 text-green-600">${totalIncome.toLocaleString()} ₺</h3>
                                    </div>
                                    <div class="p-3 bg-green-100 dark:bg-green-900/50 rounded-lg">
                                        <i data-lucide="trending-up" class="w-6 h-6 text-green-600"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="finance-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">إجمالي المصروفات</p>
                                        <h3 class="text-2xl font-bold mt-1 text-red-600">${totalExpense.toLocaleString()} ₺</h3>
                                    </div>
                                    <div class="p-3 bg-red-100 dark:bg-red-900/50 rounded-lg">
                                        <i data-lucide="trending-down" class="w-6 h-6 text-red-600"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="finance-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">الرصيد الحالي</p>
                                        <h3 class="text-2xl font-bold mt-1 ${balance >= 0 ? 'text-blue-600' : 'text-red-600'}">${balance.toLocaleString()} ₺</h3>
                                    </div>
                                    <div class="p-3 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
                                        <i data-lucide="wallet" class="w-6 h-6 text-blue-600"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="finance-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">المدخرات</p>
                                        <h3 class="text-2xl font-bold mt-1 text-purple-600">${finance.savings?.toLocaleString() || 0} ₺</h3>
                                    </div>
                                    <div class="p-3 bg-purple-100 dark:bg-purple-900/50 rounded-lg">
                                        <i data-lucide="piggy-bank" class="w-6 h-6 text-purple-600"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- BUDGETS -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📊 الميزانيات</h3>
                            <div class="space-y-4">
                                ${budgets.map(budget => {
                                    const percentage = Math.min(100, (budget.spent / budget.limit) * 100);
                                    const isOverBudget = budget.spent > budget.limit;
                                    return `
                                        <div>
                                            <div class="flex justify-between items-center mb-2">
                                                <span class="font-medium">${budget.category}</span>
                                                <span class="font-bold ${isOverBudget ? 'text-red-600' : 'text-green-600'}">
                                                    ${budget.spent.toLocaleString()} / ${budget.limit.toLocaleString()} ₺
                                                </span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill ${isOverBudget ? 'bg-red-500' : 'bg-green-500'}" style="width: ${percentage}%"></div>
                                            </div>
                                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                                <span>${percentage.toFixed(1)}%</span>
                                                <span>${isOverBudget ? 'تجاوز الميزانية' : 'ضمن الميزانية'}</span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <!-- RECENT TRANSACTIONS -->
                        <div class="card">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">آخر المعاملات</h3>
                                <button onclick="App.showAllTransactions()" class="text-sm text-blue-600 hover:underline">
                                    عرض الكل →
                                </button>
                            </div>
                            <div class="space-y-3">
                                ${transactions.slice(0, 5).map(transaction => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-full flex items-center justify-center ${transaction.type === 'income' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">
                                                <i data-lucide="${transaction.type === 'income' ? 'arrow-down-right' : 'arrow-up-right'}" class="w-5 h-5"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-700 dark:text-gray-300">${transaction.description}</p>
                                                <p class="text-xs text-gray-500">${transaction.category} • ${transaction.date}</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="font-bold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                                ${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toLocaleString()} ₺
                                            </p>
                                            <p class="text-xs text-gray-500">${transaction.note || ''}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- SAVINGS GOALS -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">🎯 أهداف التوفير</h3>
                            <div class="space-y-4">
                                ${savingsGoals.map(goal => {
                                    const percentage = Math.min(100, (goal.saved / goal.target) * 100);
                                    return `
                                        <div>
                                            <div class="flex justify-between items-center mb-2">
                                                <span class="font-medium">${goal.name}</span>
                                                <span class="font-bold">${goal.saved.toLocaleString()} / ${goal.target.toLocaleString()} ₺</span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill bg-blue-500" style="width: ${percentage}%"></div>
                                            </div>
                                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                                <span>${percentage.toFixed(1)}%</span>
                                                <span>ينتهي ${goal.deadline}</span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <!-- FINANCIAL INSIGHTS -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📈 تحليلات مالية</h3>
                            <div class="h-64">
                                <canvas id="financeChart"></canvas>
                            </div>
                        </div>
                    </div>
                `;
            }

            static journalManager() {
                const state = AppState.getInstance();
                const journals = state.journals || [];
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">📓 مدوناتي</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">سجل أفكارك ومشاعرك وتجاربك اليومية</p>
                            </div>
                            <button onclick="App.addNewJournal()" class="btn-primary px-4 py-2">
                                <i data-lucide="plus" class="w-5 h-5 inline ml-2"></i>
                                تدوين جديد
                            </button>
                        </div>
                        
                        <!-- QUICK STATS -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2">${journals.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">إجمالي التدوينات</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2">${journals.filter(j => new Date(j.date).toDateString() === new Date().toDateString()).length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">اليوم</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-purple-600 mb-2">${new Set(journals.map(j => j.mood)).size}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">حالات مزاجية</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-orange-600 mb-2">${new Set(journals.flatMap(j => j.tags || [])).size}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">وسوم مختلفة</p>
                            </div>
                        </div>
                        
                        <!-- RECENT JOURNALS -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">آخر التدوينات</h3>
                            <div class="space-y-4">
                                ${journals.slice(0, 3).map(journal => `
                                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-blue-300 transition-colors">
                                        <div class="flex justify-between items-start mb-3">
                                            <h4 class="font-bold text-gray-800 dark:text-white">${journal.title}</h4>
                                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded text-xs">
                                                ${new Date(journal.date).toLocaleDateString('ar-EG')}
                                            </span>
                                        </div>
                                        <p class="text-gray-600 dark:text-gray-400 mb-3 line-clamp-2">${journal.content}</p>
                                        <div class="flex justify-between items-center">
                                            <div class="flex gap-2">
                                                ${journal.tags.map(tag => `
                                                    <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300 rounded text-xs">
                                                        ${tag}
                                                    </span>
                                                `).join('')}
                                            </div>
                                            <button onclick="App.viewJournal('${journal.id}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                                قراءة المزيد →
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- MOOD TRACKER -->
                        <div class="card">
                            <h4 class="font-bold text-lg text-gray-900 dark:text-white mb-4">😊 متتبع المزاج</h4>
                            <div class="grid grid-cols-5 gap-2">
                                ${['😊', '😄', '😐', '😔', '😢'].map((mood, index) => `
                                    <button onclick="App.setTodayMood(${index + 1})" class="p-4 text-2xl bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50">
                                        ${mood}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- JOURNALING TIPS -->
                        <div class="card bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20">
                            <div class="flex items-start gap-3">
                                <div class="p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
                                    <i data-lucide="lightbulb" class="w-5 h-5 text-blue-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-blue-700 dark:text-blue-300 mb-2">نصائح للتدوين الفعال</h4>
                                    <ul class="text-sm text-blue-600 dark:text-blue-400 space-y-1">
                                        <li>• اكتب بانتظام حتى لو كانت بضع جمل</li>
                                        <li>• صف مشاعرك وأفكارك بصدق</li>
                                        <li>• راجع تدويناتك القديمة لترى تطورك</li>
                                        <li>• استخدم الوسوم لتنظيم أفكارك</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static secureNotes() {
                const state = AppState.getInstance();
                const notes = state.notes || [];
                const encryptedNotes = notes.filter(n => n.isEncrypted);
                const regularNotes = notes.filter(n => !n.isEncrypted);
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">🔒 الملاحظات الآمنة</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">خزن معلوماتك الحساسة بشكل آمن ومشفر</p>
                            </div>
                            <button onclick="App.addNewNote()" class="btn-primary px-4 py-2">
                                <i data-lucide="plus" class="w-5 h-5 inline ml-2"></i>
                                ملاحظة جديدة
                            </button>
                        </div>
                        
                        <!-- SECURITY STATS -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2">${notes.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">إجمالي الملاحظات</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2">${encryptedNotes.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ملاحظات مشفرة</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-red-600 mb-2">${regularNotes.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ملاحظات عادية</p>
                            </div>
                        </div>
                        
                        <!-- NOTES TABLE -->
                        <div class="card">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">قائمة الملاحظات</h3>
                                <div class="flex gap-2">
                                    <select class="notion-input text-sm w-auto" onchange="App.filterNotesByType(this.value)">
                                        <option value="all">جميع الملاحظات</option>
                                        <option value="encrypted">مشفرة فقط</option>
                                        <option value="regular">عادية فقط</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full text-right">
                                    <thead class="bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-xs font-bold uppercase">
                                        <tr>
                                            <th class="py-3 px-4">العنوان</th>
                                            <th class="py-3 px-4">النوع</th>
                                            <th class="py-3 px-4">الفئة</th>
                                            <th class="py-3 px-4">آخر تعديل</th>
                                            <th class="py-3 px-4">الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${notes.length > 0 ? notes.map(note => `
                                            <tr class="border-b border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800">
                                                <td class="py-3 px-4">
                                                    <div class="flex items-center gap-3">
                                                        ${note.isEncrypted ? '<i data-lucide="lock" class="w-4 h-4 text-green-600"></i>' : '<i data-lucide="file-text" class="w-4 h-4 text-blue-600"></i>'}
                                                        <div>
                                                            <p class="font-medium text-gray-700 dark:text-gray-300">${note.title}</p>
                                                            <p class="text-xs text-gray-500">${note.content.substring(0, 30)}...</p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="px-2 py-1 rounded-full text-xs ${note.isEncrypted ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600'}">
                                                        ${note.isEncrypted ? 'مشفرة' : 'عادية'}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">
                                                        ${note.category || 'عام'}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="text-sm text-gray-500">
                                                        ${new Date(note.updatedAt).toLocaleDateString('ar-EG')}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <div class="flex gap-2">
                                                        <button onclick="App.viewNote('${note.id}')" class="p-1 text-blue-600 hover:text-blue-800">
                                                            <i data-lucide="eye" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.editNote('${note.id}')" class="p-1 text-green-600 hover:text-green-800">
                                                            <i data-lucide="edit" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.deleteNote('${note.id}')" class="p-1 text-red-600 hover:text-red-800">
                                                            <i data-lucide="trash" class="w-4 h-4"></i>
                                                        </button>
                                                        ${note.isEncrypted ? `
                                                            <button onclick="App.decryptNote('${note.id}')" class="p-1 text-purple-600 hover:text-purple-800">
                                                                <i data-lucide="key" class="w-4 h-4"></i>
                                                            </button>
                                                        ` : ''}
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('') : `
                                            <tr>
                                                <td colspan="5" class="py-8 text-center text-gray-500">
                                                    <i data-lucide="sticky-note" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                                                    <p>لا توجد ملاحظات بعد</p>
                                                    <button onclick="App.addNewNote()" class="mt-2 text-blue-600 hover:underline">
                                                        إضافة أول ملاحظة
                                                    </button>
                                                </td>
                                            </tr>
                                        `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- SECURITY TIPS -->
                        <div class="card bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20">
                            <div class="flex items-start gap-3">
                                <div class="p-2 bg-red-100 dark:bg-red-900/50 rounded-lg">
                                    <i data-lucide="shield-alert" class="w-5 h-5 text-red-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-red-700 dark:text-red-300 mb-2">نصائح أمان مهمة</h4>
                                    <ul class="text-sm text-red-600 dark:text-red-400 space-y-1">
                                        <li>• استخدم كلمات مرور قوية للملاحظات المشفرة</li>
                                        <li>• لا تخزن كلمات مرور حقيقية في الملاحظات العادية</li>
                                        <li>• قم بتحديث كلمات المرور بانتظام</li>
                                        <li>• لا تشارك الملاحظات المشفرة مع أحد</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            static projects() {
                const state = AppState.getInstance();
                const projects = state.projects || [];
                const activeProjects = projects.filter(p => p.status === 'in-progress');
                const completedProjects = projects.filter(p => p.status === 'completed');
                const planningProjects = projects.filter(p => p.status === 'planning');
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">📂 المشاريع</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">إدارة مشاريعك وتتبع تقدمها بشكل متكامل</p>
                            </div>
                            <button onclick="App.addNewProject()" class="btn-primary px-4 py-2">
                                <i data-lucide="plus" class="w-5 h-5 inline ml-2"></i>
                                مشروع جديد
                            </button>
                        </div>
                        
                        <!-- PROJECTS STATS -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2">${projects.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">إجمالي المشاريع</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2">${activeProjects.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">قيد التنفيذ</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-purple-600 mb-2">${completedProjects.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">مكتملة</p>
                            </div>
                            <div class="card text-center">
                                <div class="text-3xl font-bold text-orange-600 mb-2">${planningProjects.length}</div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">قيد التخطيط</p>
                            </div>
                        </div>
                        
                        <!-- ACTIVE PROJECTS -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">المشاريع النشطة</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${activeProjects.map(project => `
                                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-blue-300 transition-colors">
                                        <div class="flex justify-between items-start mb-3">
                                            <h4 class="font-bold text-gray-800 dark:text-white">${project.name}</h4>
                                            <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300 rounded text-xs">
                                                ${project.priority === 'high' ? 'عالي' : 'متوسط'}
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">${project.description}</p>
                                        <div class="mb-4">
                                            <div class="flex justify-between text-sm mb-1">
                                                <span>التقدم</span>
                                                <span class="font-bold">${project.progress}%</span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: ${project.progress}%"></div>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-xs text-gray-500">${project.deadline}</span>
                                            <button onclick="App.viewProject('${project.id}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                                التفاصيل →
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- PROJECTS TABLE -->
                        <div class="card">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="font-bold text-lg text-gray-900 dark:text-white">جميع المشاريع</h3>
                                <div class="flex gap-2">
                                    <select class="notion-input text-sm w-auto" onchange="App.filterProjectsByStatus(this.value)">
                                        <option value="all">جميع الحالات</option>
                                        <option value="planning">قيد التخطيط</option>
                                        <option value="in-progress">قيد التنفيذ</option>
                                        <option value="completed">مكتملة</option>
                                        <option value="on-hold">معلقة</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full text-right">
                                    <thead class="bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-xs font-bold uppercase">
                                        <tr>
                                            <th class="py-3 px-4">المشروع</th>
                                            <th class="py-3 px-4">الحالة</th>
                                            <th class="py-3 px-4">الأولوية</th>
                                            <th class="py-3 px-4">التقدم</th>
                                            <th class="py-3 px-4">الموعد النهائي</th>
                                            <th class="py-3 px-4">الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${projects.length > 0 ? projects.map(project => `
                                            <tr class="border-b border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800">
                                                <td class="py-3 px-4">
                                                    <div class="flex items-center gap-3">
                                                        <div class="w-8 h-8 rounded" style="background: ${project.color || '#3b82f6'}"></div>
                                                        <div>
                                                            <p class="font-medium text-gray-700 dark:text-gray-300">${project.name}</p>
                                                            <p class="text-xs text-gray-500">${project.description.substring(0, 30)}...</p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="px-2 py-1 rounded-full text-xs ${project.status === 'in-progress' ? 'bg-green-100 text-green-600' : project.status === 'completed' ? 'bg-purple-100 text-purple-600' : 'bg-yellow-100 text-yellow-600'}">
                                                        ${project.status === 'planning' ? 'قيد التخطيط' : 
                                                          project.status === 'in-progress' ? 'قيد التنفيذ' : 
                                                          project.status === 'completed' ? 'مكتمل' : 'معلق'}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="px-2 py-1 rounded-full text-xs priority-${project.priority}">
                                                        ${project.priority === 'high' ? 'عالي' : 'متوسط'}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <div class="flex items-center gap-2">
                                                        <div class="progress-bar w-20">
                                                            <div class="progress-fill" style="width: ${project.progress}%"></div>
                                                        </div>
                                                        <span class="text-sm font-bold">${project.progress}%</span>
                                                    </div>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="${new Date(project.deadline) < new Date() && project.status !== 'completed' ? 'text-red-600 font-bold' : 'text-gray-600'}">
                                                        ${project.deadline}
                                                    </span>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <div class="flex gap-2">
                                                        <button onclick="App.viewProject('${project.id}')" class="p-1 text-blue-600 hover:text-blue-800">
                                                            <i data-lucide="eye" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.editProject('${project.id}')" class="p-1 text-green-600 hover:text-green-800">
                                                            <i data-lucide="edit" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="App.deleteProject('${project.id}')" class="p-1 text-red-600 hover:text-red-800">
                                                            <i data-lucide="trash" class="w-4 h-4"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('') : `
                                            <tr>
                                                <td colspan="6" class="py-8 text-center text-gray-500">
                                                    <i data-lucide="briefcase" class="w-12 h-12 mx-auto text-gray-300 mb-3"></i>
                                                    <p>لا توجد مشاريع بعد</p>
                                                    <button onclick="App.addNewProject()" class="mt-2 text-blue-600 hover:underline">
                                                        إضافة أول مشروع
                                                    </button>
                                                </td>
                                            </tr>
                                        `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- PROJECT INSIGHTS -->
                        <div class="card">
                            <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">📊 تحليلات المشاريع</h3>
                            <div class="h-64">
                                <canvas id="projectsChart"></canvas>
                            </div>
                        </div>
                    </div>
                `;
            }

            static settings() {
                const state = AppState.getInstance();
                const user = state.user;
                const settings = user?.settings || {};
                const themes = ['blue', 'green', 'purple', 'pink', 'teal', 'orange'];
                const fontSizes = ['small', 'medium', 'large', 'x-large'];
                
                return `
                    <div class="space-y-6 animate-fade-in">
                        <!-- HEADER -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">⚙️ الإعدادات المتقدمة</h2>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">خصّص نظام LifeOS ليناسب احتياجاتك</p>
                            </div>
                        </div>
                        
                        <!-- SETTINGS SECTIONS -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- LEFT COLUMN -->
                            <div class="lg:col-span-2 space-y-6">
                                <!-- GENERAL SETTINGS -->
                                <div class="card">
                                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">الإعدادات العامة</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">اسم المستخدم</label>
                                            <input type="text" value="${user?.name || ''}" class="notion-input" id="user-name">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">البريد الإلكتروني</label>
                                            <input type="email" value="${user?.email || ''}" class="notion-input" id="user-email-input">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">لغة الواجهة</label>
                                            <select class="notion-input" id="language">
                                                <option value="ar" ${settings.language === 'ar' ? 'selected' : ''}>العربية</option>
                                                <option value="en" ${settings.language === 'en' ? 'selected' : ''}>الإنجليزية</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- APPEARANCE SETTINGS -->
                                <div class="card">
                                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">المظهر</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">السمة اللونية</label>
                                            <div class="flex gap-2">
                                                ${themes.map(theme => `
                                                    <button onclick="App.changeTheme('${theme}')" 
                                                            class="w-10 h-10 rounded-lg ${settings.theme === theme ? 'ring-2 ring-offset-2 ring-blue-500' : ''}"
                                                            style="background: ${theme === 'blue' ? '#3b82f6' : 
                                                                      theme === 'green' ? '#16a34a' : 
                                                                      theme === 'purple' ? '#7c3aed' : 
                                                                      theme === 'pink' ? '#db2777' : 
                                                                      theme === 'teal' ? '#0d9488' : '#ea580c'}">
                                                    </button>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">حجم الخط</label>
                                            <select class="notion-input" id="font-size">
                                                ${fontSizes.map(size => `
                                                    <option value="${size}" ${settings.fontSize === size ? 'selected' : ''}>
                                                        ${size === 'small' ? 'صغير' : 
                                                         size === 'medium' ? 'متوسط' : 
                                                         size === 'large' ? 'كبير' : 'كبير جداً'}
                                                    </option>
                                                `).join('')}
                                            </select>
                                        </div>
                                        <div>
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" ${settings.darkMode ? 'checked' : ''} 
                                                       class="rounded" id="dark-mode"
                                                       onchange="App.toggleTheme()">
                                                <span class="text-sm">الوضع الداكن</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- NOTIFICATIONS SETTINGS -->
                                <div class="card">
                                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">الإشعارات</h3>
                                    <div class="space-y-3">
                                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded">
                                            <span class="text-sm">تفعيل الإشعارات</span>
                                            <input type="checkbox" ${settings.notifications ? 'checked' : ''} 
                                                   class="rounded" id="notifications-enabled">
                                        </label>
                                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded">
                                            <span class="text-sm">تذكير بالمهام</span>
                                            <input type="checkbox" ${settings.taskReminders ? 'checked' : ''} 
                                                   class="rounded" id="task-reminders">
                                        </label>
                                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded">
                                            <span class="text-sm">تذكير بالمواعيد النهائية</span>
                                            <input type="checkbox" ${settings.goalDeadlines ? 'checked' : ''} 
                                                   class="rounded" id="goal-deadlines">
                                        </label>
                                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded">
                                            <span class="text-sm">تذكير بالمراجعة الأسبوعية</span>
                                            <input type="checkbox" ${settings.weeklyReview ? 'checked' : ''} 
                                                   class="rounded" id="weekly-review">
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- RIGHT COLUMN -->
                            <div class="space-y-6">
                                <!-- ACCOUNT SUMMARY -->
                                <div class="card">
                                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">ملخص الحساب</h3>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">تاريخ الإنشاء</span>
                                            <span class="text-sm font-medium">${new Date(user?.createdAt || new Date()).toLocaleDateString('ar-EG')}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">آخر دخول</span>
                                            <span class="text-sm font-medium">${new Date(user?.lastLogin || new Date()).toLocaleDateString('ar-EG')}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">الباقة</span>
                                            <span class="text-sm font-medium text-green-600">${user?.plan === 'premium' ? 'مميزة' : 'مجانية'}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- DATA MANAGEMENT -->
                                <div class="card">
                                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">إدارة البيانات</h3>
                                    <div class="space-y-3">
                                        <button onclick="App.exportAllData()" class="w-full p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 rounded-lg text-sm font-medium hover:bg-blue-100 dark:hover:bg-blue-900/30">
                                            <i data-lucide="download" class="w-4 h-4 inline ml-2"></i>
                                            تصدير جميع البيانات
                                        </button>
                                        <button onclick="App.importData()" class="w-full p-3 bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-300 rounded-lg text-sm font-medium hover:bg-green-100 dark:hover:bg-green-900/30">
                                            <i data-lucide="upload" class="w-4 h-4 inline ml-2"></i>
                                            استيراد بيانات
                                        </button>
                                        <button onclick="App.resetData()" class="w-full p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-300 rounded-lg text-sm font-medium hover:bg-red-100 dark:hover:bg-red-900/30">
                                            <i data-lucide="trash-2" class="w-4 h-4 inline ml-2"></i>
                                            إعادة تعيين البيانات
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- SYSTEM INFO -->
                                <div class="card">
                                    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">معلومات النظام</h3>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>الإصدار</span>
                                            <span class="font-medium">LifeOS V14</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>آخر تحديث</span>
                                            <span class="font-medium">${new Date().toLocaleDateString('ar-EG')}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>عدد السجلات</span>
                                            <span class="font-medium">${state.goals.length + state.tasks.length + state.notes.length}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- SAVE BUTTON -->
                                <button onclick="App.saveSettings()" class="w-full btn-primary py-3">
                                    <i data-lucide="save" class="w-5 h-5 inline ml-2"></i>
                                    حفظ الإعدادات
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        /* ===== 6. APPLICATION CONTROLLER ===== */
        class AppController {
            constructor() {
                this.state = AppState.getInstance();
                this.views = Views;
                this.init();
            }

            init() {
                // Check authentication
                if (!Auth.check()) {
                    this.showAuthScreen();
                } else {
                    this.showApp();
                    this.applyUserSettings();
                    this.navigate('dashboard');
                }

                // Initialize event listeners
                this.initEventListeners();
            }

            showAuthScreen() {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('app-container').classList.add('hidden');
            }

            showApp() {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                
                // Update user info
                this.updateUserInfo();
                this.state.updateSidebarStats();
            }

            applyUserSettings() {
                this.state.applyTheme();
                
                // Apply font settings
                const settings = this.state.user?.settings;
                if (settings) {
                    if (settings.fontFamily) {
                        document.body.style.fontFamily = settings.fontFamily;
                    }
                    if (settings.fontSize) {
                        const sizes = { small: '14px', medium: '16px', large: '18px', 'x-large': '20px' };
                        document.body.style.fontSize = sizes[settings.fontSize] || '16px';
                    }
                }
            }

            updateUserInfo() {
                const user = this.state.user;
                if (!user) return;

                // Update name elements
                const nameElements = document.querySelectorAll('[id*="user-name"], [id*="profile-name"]');
                nameElements.forEach(el => {
                    el.textContent = user.name;
                });

                // Update email
                const emailElement = document.getElementById('user-email');
                if (emailElement) emailElement.textContent = user.email;

                // Update avatar
                const avatarElements = document.querySelectorAll('[id*="avatar"]');
                avatarElements.forEach(el => {
                    if (user.avatar) {
                        el.style.backgroundImage = `url(${user.avatar})`;
                        el.style.backgroundSize = 'cover';
                        el.innerHTML = '';
                    } else {
                        const icon = el.querySelector('i') || document.createElement('i');
                        icon.setAttribute('data-lucide', 'user');
                        el.innerHTML = '';
                        el.appendChild(icon);
                        lucide.createIcons();
                    }
                });
            }

            initEventListeners() {
                // Auth form
                const authForm = document.getElementById('auth-form');
                if (authForm) {
                    authForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const username = document.getElementById('auth-username').value;
                        const password = document.getElementById('auth-password').value;
                        
                        if (Auth.login(username, password)) {
                            this.state = AppState.getInstance();
                            this.showApp();
                            this.applyUserSettings();
                            this.navigate('dashboard');
                            UI.toast('تم تسجيل الدخول بنجاح', 'success');
                        } else {
                            document.getElementById('auth-error').classList.remove('hidden');
                            UI.toast('بيانات الدخول غير صحيحة', 'error');
                        }
                    });
                }

                // Close dropdowns when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#notifications-dropdown') && !e.target.closest('button[onclick*="toggleNotifications"]')) {
                        document.getElementById('notifications-dropdown').classList.add('hidden');
                    }
                    if (!e.target.closest('#user-menu') && !e.target.closest('button[onclick*="toggleUserMenu"]')) {
                        document.getElementById('user-menu').classList.add('hidden');
                    }
                    if (!e.target.closest('#quick-actions-modal')) {
                        document.getElementById('quick-actions-modal').classList.add('hidden');
                    }
                });

                // Initialize icons
                lucide.createIcons();
            }

            navigate(view, params = null) {
                this.state.currentView = view;
                
                // Update active nav item
                this.updateActiveNavItem(view);
                
                // Update page title
                const titles = {
                    'dashboard': 'لوحة التحكم',
                    'dailyTracker': 'المتابعة اليومية',
                    'weeklyReview': 'المراجعة الأسبوعية',
                    'monthlyReview': 'المراجعة الشهرية',
                    'reviewResults': 'نتائج المراجعات',
                    'aspectsEditor': 'إدارة الجوانب',
                    'advancedGoals': 'الأهداف المتقدمة',
                    'financeAdvanced': 'المالية المتقدمة',
                    'journalManager': 'مدوناتي',
                    'secureNotes': 'الملاحظات الآمنة',
                    'projects': 'المشاريع',
                    'settings': 'الإعدادات'
                };
                
                UI.updatePageTitle(titles[view] || view);
                
                // Close sidebar on mobile
                if (window.innerWidth < 768) {
                    this.toggleSidebar(false);
                }
                
                // Render view
                const content = document.getElementById('app-content');
                if (this.views[view]) {
                    content.innerHTML = this.views[view](params);
                    lucide.createIcons();
                    
                    // Update sidebar stats
                    this.state.updateSidebarStats();
                    
                    // Initialize charts if needed
                    if (view === 'financeAdvanced') {
                        setTimeout(() => this.initFinanceCharts(), 100);
                    }
                    if (view === 'advancedGoals') {
                        setTimeout(() => this.initGoalCharts(), 100);
                    }
                    if (view === 'projects') {
                        setTimeout(() => this.initProjectCharts(), 100);
                    }
                    if (view === 'reviewResults') {
                        setTimeout(() => this.initReviewCharts(), 100);
                    }
                } else {
                    content.innerHTML = `
                        <div class="text-center py-12">
                            <i data-lucide="alert-circle" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                            <h2 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">الصفحة غير متوفرة</h2>
                            <p class="text-gray-500 mb-6">هذه الصفحة قيد التطوير</p>
                            <button onclick="App.navigate('dashboard')" class="btn-primary px-6 py-2">
                                العودة للوحة التحكم
                            </button>
                        </div>
                    `;
                }
            }

            updateActiveNavItem(view) {
                // Remove active class from all nav items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    const iconContainer = item.querySelector('.icon-container');
                    if (iconContainer) {
                        iconContainer.classList.remove('bg-blue-100', 'dark:bg-blue-900/50', 'text-blue-600');
                    }
                });
                
                // Add active class to current nav item
                const navItem = document.querySelector(`.nav-item[onclick*="${view}"]`);
                if (navItem) {
                    navItem.classList.add('active');
                    const iconContainer = navItem.querySelector('.icon-container');
                    if (iconContainer) {
                        iconContainer.classList.add('bg-blue-100', 'dark:bg-blue-900/50', 'text-blue-600');
                    }
                }
            }

            toggleSidebar(forceState = null) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                
                if (forceState === null) {
                    const isOpen = sidebar.classList.contains('open');
                    forceState = !isOpen;
                }
                
                if (forceState) {
                    sidebar.classList.add('open');
                    overlay.classList.remove('hidden');
                } else {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                }
            }

            toggleTheme() {
                const user = this.state.user;
                if (user) {
                    user.settings.darkMode = !user.settings.darkMode;
                    this.state.updateUserSettings(user.settings);
                    UI.toast(`تم ${user.settings.darkMode ? 'تفعيل' : 'إلغاء'} الوضع الداكن`, 'success');
                }
            }

            changeTheme(theme) {
                const user = this.state.user;
                if (user) {
                    user.settings.theme = theme;
                    this.state.updateUserSettings(user.settings);
                    UI.toast(`تم تغيير الثيم إلى ${theme}`, 'success');
                }
            }

            toggleNotifications() {
                const dropdown = document.getElementById('notifications-dropdown');
                dropdown.classList.toggle('hidden');
            }

            toggleUserMenu() {
                const menu = document.getElementById('user-menu');
                menu.classList.toggle('hidden');
            }

            showQuickActions() {
                document.getElementById('quick-actions-modal').classList.remove('hidden');
            }

            quickAction(type) {
                document.getElementById('quick-actions-modal').classList.add('hidden');
                
                switch(type) {
                    case 'task':
                        this.addTask();
                        break;
                    case 'goal':
                        this.addGoal();
                        break;
                    case 'note':
                        this.addNote();
                        break;
                    case 'reminder':
                        this.addReminder();
                        break;
                }
            }

            // Daily Tracker Methods
            toggleDailyCheck(key, checked) {
                const date = this.state.currentDate;
                if (!this.state.data[date]) {
                    this.state.data[date] = {};
                }
                if (!this.state.data[date].checks) {
                    this.state.data[date].checks = {};
                }
                
                this.state.data[date].checks[key] = checked;
                this.state.save();
                this.state.updateSidebarStats();
            }

            saveDailyNote(key, note) {
                const date = this.state.currentDate;
                if (!this.state.data[date]) {
                    this.state.data[date] = {};
                }
                if (!this.state.data[date].notes) {
                    this.state.data[date].notes = {};
                }
                
                this.state.data[date].notes[key] = note;
                this.state.save();
            }

            updateMetric(metric, value) {
                const date = this.state.currentDate;
                if (!this.state.data[date]) {
                    this.state.data[date] = {};
                }
                if (!this.state.data[date].metrics) {
                    this.state.data[date].metrics = {};
                }
                
                this.state.data[date].metrics[metric] = parseInt(value);
                this.state.save();
            }

            saveDailySummary(summary) {
                const date = this.state.currentDate;
                if (!this.state.data[date]) {
                    this.state.data[date] = {};
                }
                
                this.state.data[date].summary = summary;
                this.state.save();
            }

            saveDailyProgress() {
                this.state.save();
                UI.toast('تم حفظ تقدم اليوم بنجاح', 'success');
            }

            resetDay() {
                const date = this.state.currentDate;
                this.state.data[date] = { checks: {}, notes: {}, metrics: {}, summary: '' };
                this.state.save();
                UI.toast('تم إعادة تعيين اليوم', 'info');
                this.navigate('dailyTracker');
            }

            changeDate(date) {
                this.state.currentDate = date;
                this.navigate('dailyTracker');
            }

            // Weekly Review Methods
            toggleWeeklyCheck(key, checked) {
                const weekId = this.state.getWeekId(new Date());
                if (!this.state.data[weekId]) {
                    this.state.data[weekId] = {};
                }
                if (!this.state.data[weekId].checks) {
                    this.state.data[weekId].checks = {};
                }
                
                this.state.data[weekId].checks[key] = checked;
                this.state.save();
            }

            saveWeeklyData(field, value) {
                const weekId = this.state.getWeekId(new Date());
                if (!this.state.data[weekId]) {
                    this.state.data[weekId] = {};
                }
                
                this.state.data[weekId][field] = value;
                this.state.save();
            }

            setWeeklyRating(rating) {
                const weekId = this.state.getWeekId(new Date());
                if (!this.state.data[weekId]) {
                    this.state.data[weekId] = {};
                }
                
                this.state.data[weekId].rating = rating;
                this.state.save();
                this.navigate('weeklyReview');
            }

            saveWeeklyReview() {
                this.state.save();
                UI.toast('تم حفظ المراجعة الأسبوعية', 'success');
            }

            generateWeeklyReport() {
                UI.toast('جاري إنشاء التقرير الأسبوعي...', 'info');
                setTimeout(() => {
                    UI.toast('تم إنشاء التقرير بنجاح', 'success');
                }, 1500);
            }

            // Monthly Review Methods
            toggleMonthlyCheck(key, checked) {
                const monthId = this.state.getMonthId(new Date());
                if (!this.state.data[monthId]) {
                    this.state.data[monthId] = {};
                }
                if (!this.state.data[monthId].checks) {
                    this.state.data[monthId].checks = {};
                }
                
                this.state.data[monthId].checks[key] = checked;
                this.state.save();
            }

            saveMonthlyData(field, value) {
                const monthId = this.state.getMonthId(new Date());
                if (!this.state.data[monthId]) {
                    this.state.data[monthId] = {};
                }
                
                this.state.data[monthId][field] = value;
                this.state.save();
            }

            saveMonthlyReview() {
                this.state.save();
                UI.toast('تم حفظ المراجعة الشهرية', 'success');
            }

            generateMonthlyReport() {
                UI.toast('جاري إنشاء التقرير الشهري...', 'info');
                setTimeout(() => {
                    UI.toast('تم إنشاء التقرير بنجاح', 'success');
                }, 1500);
            }

            // Review Results Methods
            generateNewReview() {
                const summary = this.state.generateReviewResults();
                UI.toast('تم إنشاء تقرير المراجعة بنجاح', 'success');
                this.navigate('reviewResults');
            }

            viewReviewDetails(id) {
                const summary = this.state.reviewResults.summaries.find(s => s.id === id);
                
                if (!summary) {
                    UI.toast('لم يتم العثور على التقرير', 'error');
                    return;
                }
                
                const modalContent = `
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <h3 class="font-bold text-lg">تفاصيل التقرير</h3>
                            <span class="px-3 py-1 rounded-full text-sm ${summary.period === 'daily' ? 'bg-blue-100 text-blue-600' : summary.period === 'weekly' ? 'bg-green-100 text-green-600' : 'bg-purple-100 text-purple-600'}">
                                ${summary.period === 'daily' ? 'يومي' : summary.period === 'weekly' ? 'أسبوعي' : 'شهري'}
                            </span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg">
                                <p class="text-sm text-gray-500">التاريخ</p>
                                <p class="font-bold">${new Date(summary.createdAt).toLocaleDateString('ar-EG')}</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg">
                                <p class="text-sm text-gray-500">التقييم العام</p>
                                <p class="font-bold text-2xl ${summary.scores.dailyScore >= 70 ? 'text-green-600' : 'text-orange-600'}">
                                    ${summary.scores.dailyScore}%
                                </p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-2">📊 الإحصائيات</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span>معدل الانتظام</span>
                                    <span class="font-bold">${summary.scores.consistency}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>أيام متتالية</span>
                                    <span class="font-bold">${summary.scores.streakDays || 0}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>مستوى التحسن</span>
                                    <span class="font-bold ${summary.scores.improvement >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${summary.scores.improvement >= 0 ? '+' : ''}${summary.scores.improvement}%
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-2">🏆 أفضل الجوانب أداءً</h4>
                            <div class="space-y-2">
                                ${summary.scores.topPerformingAspects.map(aspect => `
                                    <div class="flex justify-between items-center p-2 bg-green-50 dark:bg-green-900/20 rounded">
                                        <span>${aspect.name}</span>
                                        <span class="font-bold text-green-600">${aspect.score}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-2">💡 الرؤى</h4>
                            <div class="space-y-2">
                                ${summary.insights.map(insight => `
                                    <div class="flex items-start gap-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded">
                                        <i data-lucide="lightbulb" class="w-4 h-4 text-yellow-500 mt-0.5"></i>
                                        <span>${insight}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-2">🎯 التوصيات</h4>
                            <div class="space-y-2">
                                ${summary.recommendations.map(rec => `
                                    <div class="flex items-start gap-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded">
                                        <i data-lucide="target" class="w-4 h-4 text-purple-500 mt-0.5"></i>
                                        <span>${rec}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                UI.modal('تفاصيل تقرير المراجعة', modalContent, [
                    {
                        text: 'إغلاق',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'تصدير',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: `App.exportReviewSummary('${summary.id}')`
                    }
                ]);
            }

            editReviewSummary(id) {
                const summary = this.state.reviewResults.summaries.find(s => s.id === id);
                
                if (!summary) {
                    UI.toast('لم يتم العثور على التقرير', 'error');
                    return;
                }
                
                const newScore = prompt('التقييم الجديد (0-100):', summary.scores.dailyScore);
                if (newScore && !isNaN(newScore)) {
                    summary.scores.dailyScore = parseInt(newScore);
                    summary.updatedAt = new Date().toISOString();
                    this.state.save();
                    UI.toast('تم تحديث التقرير بنجاح', 'success');
                    this.navigate('reviewResults');
                }
            }

            deleteReviewSummary(id) {
                if (confirm('هل أنت متأكد من حذف هذا التقرير؟')) {
                    const index = this.state.reviewResults.summaries.findIndex(s => s.id === id);
                    if (index !== -1) {
                        this.state.reviewResults.summaries.splice(index, 1);
                        this.state.save();
                        UI.toast('تم حذف التقرير بنجاح', 'info');
                        this.navigate('reviewResults');
                    }
                }
            }

            exportReviewSummary(id) {
                const summary = this.state.reviewResults.summaries.find(s => s.id === id);
                
                if (summary) {
                    const dataStr = JSON.stringify(summary, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `مراجعة_${summary.id}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    UI.toast('تم تصدير التقرير بنجاح', 'success');
                }
            }

            filterReviews(period) {
                UI.toast(`تم تصفية المراجعات حسب: ${period}`, 'info');
            }

            filterByDate(date) {
                if (date) {
                    UI.toast(`تم تصفية المراجعات بتاريخ: ${date}`, 'info');
                }
            }

            exportReviewResults() {
                const data = {
                    summaries: this.state.reviewResults.summaries,
                    generatedAt: new Date().toISOString(),
                    appVersion: 'LifeOS V14'
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `نتائج_المراجعات_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                UI.toast('تم تصدير جميع النتائج بنجاح', 'success');
            }

            exportToPDF() {
                UI.toast('جاري إنشاء ملف PDF...', 'info');
                setTimeout(() => {
                    UI.toast('تم إنشاء ملف PDF بنجاح', 'success');
                }, 2000);
            }

            exportToExcel() {
                UI.toast('جاري إنشاء ملف Excel...', 'info');
                setTimeout(() => {
                    UI.toast('تم إنشاء ملف Excel بنجاح', 'success');
                }, 2000);
            }

            exportToJSON() {
                this.exportReviewResults();
            }

            initReviewCharts() {
                // مخطط اتجاه الأداء
                const trendCtx = document.getElementById('performanceTrendChart');
                if (trendCtx) {
                    const summaries = this.state.reviewResults.summaries.slice(0, 7).reverse();
                    const labels = summaries.map(s => new Date(s.createdAt).toLocaleDateString('ar-EG').split('/')[0]);
                    const data = summaries.map(s => s.scores.dailyScore);
                    
                    new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'تقييم الأداء',
                                data: data,
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    rtl: true
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        callback: function(value) {
                                            return value + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // مخطط مقارنة الجوانب
                const aspectCtx = document.getElementById('aspectsComparisonChart');
                if (aspectCtx) {
                    const aspects = this.state.config.aspects || [];
                    const labels = aspects.map(a => a.name);
                    const data = aspects.map(a => this.state.calculateAspectScore(a.id));
                    
                    new Chart(aspectCtx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'التقييم',
                                data: data,
                                backgroundColor: [
                                    '#3b82f6', '#10b981', '#8b5cf6', '#f59e0b', 
                                    '#ef4444', '#06b6d4', '#ec4899'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        callback: function(value) {
                                            return value + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            initFinanceCharts() {
                const financeCtx = document.getElementById('financeChart');
                if (financeCtx) {
                    const transactions = this.state.finance.transactions || [];
                    const categories = [...new Set(transactions.map(t => t.category))];
                    
                    // حساب إجمالي المصروفات لكل فئة
                    const expensesByCategory = categories.map(category => {
                        return transactions
                            .filter(t => t.type === 'expense' && t.category === category)
                            .reduce((sum, t) => sum + t.amount, 0);
                    });
                    
                    new Chart(financeCtx, {
                        type: 'pie',
                        data: {
                            labels: categories,
                            datasets: [{
                                data: expensesByCategory,
                                backgroundColor: [
                                    '#3b82f6', '#10b981', '#8b5cf6', '#f59e0b',
                                    '#ef4444', '#06b6d4', '#ec4899', '#84cc16',
                                    '#f97316', '#8b5cf6'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'left',
                                    rtl: true
                                }
                            }
                        }
                    });
                }
            }

            initGoalCharts() {
                // مخطط إنجاز الأهداف
                const completionCtx = document.getElementById('goalCompletionChart');
                if (completionCtx) {
                    const goals = this.state.goals || [];
                    const completed = goals.filter(g => g.status === 'completed').length;
                    const inProgress = goals.filter(g => g.status === 'active').length;
                    const pending = goals.filter(g => g.status === 'pending').length;
                    
                    new Chart(completionCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['مكتملة', 'قيد التنفيذ', 'قيد الانتظار'],
                            datasets: [{
                                data: [completed, inProgress, pending],
                                backgroundColor: ['#10b981', '#3b82f6', '#f59e0b']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'left',
                                    rtl: true
                                }
                            }
                        }
                    });
                }
                
                // مخطط توزيع الأهداف حسب الفئة
                const categoryCtx = document.getElementById('goalCategoryChart');
                if (categoryCtx) {
                    const goals = this.state.goals || [];
                    const categories = this.state.config.categories?.goals || [];
                    
                    const goalsByCategory = categories.map(category => {
                        return goals.filter(g => g.category === category).length;
                    });
                    
                    new Chart(categoryCtx, {
                        type: 'bar',
                        data: {
                            labels: categories,
                            datasets: [{
                                label: 'عدد الأهداف',
                                data: goalsByCategory,
                                backgroundColor: '#3b82f6'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            }
                        }
                    });
                }
            }

            initProjectCharts() {
                const projectsCtx = document.getElementById('projectsChart');
                if (projectsCtx) {
                    const projects = this.state.projects || [];
                    const statuses = ['قيد التخطيط', 'قيد التنفيذ', 'مكتملة', 'معلقة'];
                    const counts = [
                        projects.filter(p => p.status === 'planning').length,
                        projects.filter(p => p.status === 'in-progress').length,
                        projects.filter(p => p.status === 'completed').length,
                        projects.filter(p => p.status === 'on-hold').length
                    ];
                    
                    new Chart(projectsCtx, {
                        type: 'polarArea',
                        data: {
                            labels: statuses,
                            datasets: [{
                                data: counts,
                                backgroundColor: [
                                    '#f59e0b',
                                    '#3b82f6',
                                    '#10b981',
                                    '#ef4444'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'left',
                                    rtl: true
                                }
                            }
                        }
                    });
                }
            }

            // Aspects Editor Methods
            addNewAspect() {
                const name = prompt('اسم الجانب الجديد:');
                if (!name) return;
                
                const icon = prompt('الأيقونة (اسم أيقونة Lucide):', 'circle');
                const color = prompt('اللون (hex):', '#3b82f6');
                
                this.state.config.aspects.push({
                    id: 'aspect_' + Date.now(),
                    name,
                    icon: icon || 'circle',
                    color: color || '#3b82f6',
                    daily: [],
                    weekly: [],
                    monthly: []
                });
                
                this.state.save();
                UI.toast('تم إضافة الجانب الجديد', 'success');
                this.navigate('aspectsEditor');
            }

            editAspect(index) {
                const aspect = this.state.config.aspects[index];
                const newName = prompt('اسم الجانب:', aspect.name);
                if (!newName) return;
                
                const newIcon = prompt('الأيقونة:', aspect.icon);
                const newColor = prompt('اللون:', aspect.color);
                
                this.state.config.aspects[index].name = newName;
                this.state.config.aspects[index].icon = newIcon || aspect.icon;
                this.state.config.aspects[index].color = newColor || aspect.color;
                
                this.state.save();
                UI.toast('تم تعديل الجانب', 'success');
                this.navigate('aspectsEditor');
            }

            deleteAspect(index) {
                if (confirm('هل أنت متأكد من حذف هذا الجانب؟')) {
                    this.state.config.aspects.splice(index, 1);
                    this.state.save();
                    UI.toast('تم حذف الجانب', 'info');
                    this.navigate('aspectsEditor');
                }
            }

            addTaskToAspect(aspectIndex, type) {
                const task = prompt('المهمة الجديدة:');
                if (!task) return;
                
                this.state.config.aspects[aspectIndex][type].push(task);
                this.state.save();
                this.navigate('aspectsEditor');
            }

            updateAspectTask(aspectIndex, type, taskIndex, value) {
                this.state.config.aspects[aspectIndex][type][taskIndex] = value;
                this.state.save();
            }

            removeTaskFromAspect(aspectIndex, type, taskIndex) {
                if (confirm('هل تريد حذف هذه المهمة؟')) {
                    this.state.config.aspects[aspectIndex][type].splice(taskIndex, 1);
                    this.state.save();
                    this.navigate('aspectsEditor');
                }
            }

            // Advanced Goals Methods
            addNewGoal() {
                const modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">عنوان الهدف *</label>
                            <input type="text" id="goal-title" class="notion-input" placeholder="مثال: تعلم لغة برمجة جديدة">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الوصف</label>
                            <textarea id="goal-description" class="notion-input h-24" placeholder="وصف الهدف بالتفصيل..."></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">النوع</label>
                                <select id="goal-type" class="notion-input">
                                    <option value="short-term">قصير المدى</option>
                                    <option value="medium-term">متوسط المدى</option>
                                    <option value="long-term">طويل المدى</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">الفئة</label>
                                <select id="goal-category" class="notion-input">
                                    ${this.state.config.categories?.goals.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">الأولوية</label>
                                <select id="goal-priority" class="notion-input">
                                    <option value="low">منخفضة</option>
                                    <option value="medium">متوسطة</option>
                                    <option value="high">عالية</option>
                                    <option value="critical">حرجة</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">الموعد النهائي</label>
                                <input type="date" id="goal-deadline" class="notion-input" value="${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">النسبة المئوية الحالية</label>
                            <input type="range" id="goal-progress" min="0" max="100" value="0" class="w-full">
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>0%</span>
                                <span id="goal-progress-value">0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        <div>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="goal-smart" class="rounded">
                                <span class="text-sm">هل هذا هدف ذكي (SMART)؟</span>
                            </label>
                        </div>
                    </div>
                `;
                
                UI.modal('إضافة هدف جديد', modalContent, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'حفظ الهدف',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: "App.saveNewGoal()"
                    }
                ]);
                
                // تحديث قيمة التقدم
                document.getElementById('goal-progress').addEventListener('input', function(e) {
                    document.getElementById('goal-progress-value').textContent = e.target.value + '%';
                });
            }

            saveNewGoal() {
                const title = document.getElementById('goal-title').value;
                if (!title) {
                    UI.toast('يرجى إدخال عنوان الهدف', 'error');
                    return;
                }
                
                const newGoal = {
                    id: 'goal_' + Date.now(),
                    title: title,
                    description: document.getElementById('goal-description').value,
                    type: document.getElementById('goal-type').value,
                    category: document.getElementById('goal-category').value,
                    priority: document.getElementById('goal-priority').value,
                    status: 'pending',
                    progress: parseInt(document.getElementById('goal-progress').value),
                    deadline: document.getElementById('goal-deadline').value,
                    isSmart: document.getElementById('goal-smart').checked,
                    milestones: [],
                    tags: [],
                    notes: '',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.state.goals.push(newGoal);
                this.state.save();
                
                document.querySelector('.fixed').remove();
                UI.toast('تم إضافة الهدف الجديد بنجاح', 'success');
                this.navigate('advancedGoals');
            }

            viewGoalDetails(id) {
                const goal = this.state.goals.find(g => g.id === id);
                
                if (!goal) {
                    UI.toast('لم يتم العثور على الهدف', 'error');
                    return;
                }
                
                const modalContent = `
                    <div class="space-y-4">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-lg">${goal.title}</h3>
                            <span class="px-3 py-1 rounded-full text-sm priority-${goal.priority}">
                                ${goal.priority === 'critical' ? 'حرج' : goal.priority === 'high' ? 'عالي' : goal.priority === 'medium' ? 'متوسط' : 'منخفض'}
                            </span>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-bold mb-2">وصف الهدف</h4>
                            <p class="text-gray-700 dark:text-gray-300">${goal.description || 'لا يوجد وصف'}</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg">
                                <p class="text-sm text-gray-500">النوع</p>
                                <p class="font-bold">${goal.type === 'short-term' ? 'قصير المدى' : goal.type === 'medium-term' ? 'متوسط المدى' : 'طويل المدى'}</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-800 p-3 rounded-lg">
                                <p class="text-sm text-gray-500">الحالة</p>
                                <p class="font-bold ${goal.status === 'completed' ? 'text-green-600' : goal.status === 'active' ? 'text-blue-600' : 'text-orange-600'}">
                                    ${goal.status === 'pending' ? 'قيد الانتظار' : 
                                      goal.status === 'active' ? 'قيد التنفيذ' : 
                                      goal.status === 'review' ? 'قيد المراجعة' : 'مكتمل'}
                                </p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-2">التقدم</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${goal.progress}%"></div>
                            </div>
                            <div class="flex justify-between text-sm mt-1">
                                <span>التقدم</span>
                                <span class="font-bold">${goal.progress}%</span>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-2">الموعد النهائي</h4>
                            <p class="${new Date(goal.deadline) < new Date() && goal.status !== 'completed' ? 'text-red-600 font-bold' : 'text-gray-600'}">
                                ${new Date(goal.deadline).toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                                ${new Date(goal.deadline) < new Date() && goal.status !== 'completed' ? ' (متأخر)' : ''}
                            </p>
                        </div>
                        
                        ${goal.milestones.length > 0 ? `
                            <div>
                                <h4 class="font-bold mb-2">المحطات الرئيسية</h4>
                                <div class="space-y-2">
                                    ${goal.milestones.map((milestone, index) => `
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" ${milestone.completed ? 'checked' : ''} 
                                                   class="custom-checkbox"
                                                   onchange="App.toggleMilestone('${goal.id}', ${index}, this.checked)">
                                            <span class="${milestone.completed ? 'line-through text-gray-400' : ''}">
                                                ${milestone.title}
                                            </span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${goal.notes ? `
                            <div>
                                <h4 class="font-bold mb-2">ملاحظات</h4>
                                <p class="text-gray-700 dark:text-gray-300">${goal.notes}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                UI.modal('تفاصيل الهدف', modalContent, [
                    {
                        text: 'إغلاق',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'تعديل',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: `App.editGoal('${goal.id}')`
                    }
                ]);
            }

            editGoal(id) {
                const goal = this.state.goals.find(g => g.id === id);
                
                if (!goal) {
                    UI.toast('لم يتم العثور على الهدف', 'error');
                    return;
                }
                
                const modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">عنوان الهدف</label>
                            <input type="text" id="edit-goal-title" class="notion-input" value="${goal.title}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الوصف</label>
                            <textarea id="edit-goal-description" class="notion-input h-24">${goal.description || ''}</textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">الحالة</label>
                                <select id="edit-goal-status" class="notion-input">
                                    <option value="pending" ${goal.status === 'pending' ? 'selected' : ''}>قيد الانتظار</option>
                                    <option value="active" ${goal.status === 'active' ? 'selected' : ''}>قيد التنفيذ</option>
                                    <option value="review" ${goal.status === 'review' ? 'selected' : ''}>قيد المراجعة</option>
                                    <option value="completed" ${goal.status === 'completed' ? 'selected' : ''}>مكتمل</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">التقدم</label>
                                <input type="range" id="edit-goal-progress" min="0" max="100" value="${goal.progress}" class="w-full">
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>0%</span>
                                    <span id="edit-goal-progress-value">${goal.progress}%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">ملاحظات</label>
                            <textarea id="edit-goal-notes" class="notion-input h-24">${goal.notes || ''}</textarea>
                        </div>
                    </div>
                `;
                
                UI.modal('تعديل الهدف', modalContent, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'حفظ التعديلات',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: `App.saveGoalEdit('${goal.id}')`
                    }
                ]);
                
                // تحديث قيمة التقدم
                document.getElementById('edit-goal-progress').addEventListener('input', function(e) {
                    document.getElementById('edit-goal-progress-value').textContent = e.target.value + '%';
                });
            }

            saveGoalEdit(id) {
                const goalIndex = this.state.goals.findIndex(g => g.id === id);
                
                if (goalIndex === -1) {
                    UI.toast('لم يتم العثور على الهدف', 'error');
                    return;
                }
                
                this.state.goals[goalIndex].title = document.getElementById('edit-goal-title').value;
                this.state.goals[goalIndex].description = document.getElementById('edit-goal-description').value;
                this.state.goals[goalIndex].status = document.getElementById('edit-goal-status').value;
                this.state.goals[goalIndex].progress = parseInt(document.getElementById('edit-goal-progress').value);
                this.state.goals[goalIndex].notes = document.getElementById('edit-goal-notes').value;
                this.state.goals[goalIndex].updatedAt = new Date().toISOString();
                
                this.state.save();
                
                document.querySelector('.fixed').remove();
                UI.toast('تم تحديث الهدف بنجاح', 'success');
                this.navigate('advancedGoals');
            }

            deleteGoal(id) {
                if (confirm('هل أنت متأكد من حذف هذا الهدف؟')) {
                    const goalIndex = this.state.goals.findIndex(g => g.id === id);
                    
                    if (goalIndex !== -1) {
                        this.state.goals.splice(goalIndex, 1);
                        this.state.save();
                        UI.toast('تم حذف الهدف بنجاح', 'info');
                        this.navigate('advancedGoals');
                    }
                }
            }

            toggleGoalCompletion(id, completed) {
                const goal = this.state.goals.find(g => g.id === id);
                
                if (goal) {
                    goal.status = completed ? 'completed' : 'pending';
                    goal.progress = completed ? 100 : Math.max(goal.progress, 0);
                    goal.updatedAt = new Date().toISOString();
                    this.state.save();
                    
                    UI.toast(`تم ${completed ? 'إكمال' : 'إلغاء إكمال'} الهدف`, 'success');
                    this.navigate('advancedGoals');
                }
            }

            toggleMilestone(goalId, milestoneIndex, completed) {
                const goal = this.state.goals.find(g => g.id === goalId);
                
                if (goal && goal.milestones[milestoneIndex]) {
                    goal.milestones[milestoneIndex].completed = completed;
                    goal.updatedAt = new Date().toISOString();
                    this.state.save();
                    
                    UI.toast(`تم ${completed ? 'إكمال' : 'إلغاء إكمال'} المحطة الرئيسية`, 'success');
                }
            }

            startDragGoal(event) {
                event.dataTransfer.setData('text/plain', event.target.dataset.id);
                event.target.classList.add('dragging');
            }

            filterGoalsByCategory(category) {
                UI.toast(`تم تصفية الأهداف حسب الفئة: ${category}`, 'info');
            }

            filterGoalsByPriority(priority) {
                UI.toast(`تم تصفية الأهداف حسب الأولوية: ${priority}`, 'info');
            }

            exportGoals() {
                const data = {
                    goals: this.state.goals,
                    exportedAt: new Date().toISOString(),
                    totalGoals: this.state.goals.length
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `الأهداف_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                UI.toast('تم تصدير الأهداف بنجاح', 'success');
            }

            bulkGoalActions() {
                UI.modal('إجراءات جماعية على الأهداف', `
                    <div class="space-y-4">
                        <p class="text-gray-600 dark:text-gray-400">اختر الإجراء الذي تريد تطبيقه على الأهداف المحددة:</p>
                        <div class="space-y-2">
                            <label class="flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer">
                                <input type="radio" name="bulk-action" value="delete" class="w-4 h-4">
                                <span>حذف الأهداف المحددة</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer">
                                <input type="radio" name="bulk-action" value="complete" class="w-4 h-4">
                                <span>تحديد كـ مكتملة</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer">
                                <input type="radio" name="bulk-action" value="move-active" class="w-4 h-4">
                                <span>نقل إلى قيد التنفيذ</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer">
                                <input type="radio" name="bulk-action" value="export" class="w-4 h-4">
                                <span>تصدير الأهداف المحددة</span>
                            </label>
                        </div>
                    </div>
                `, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'تطبيق',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: "App.applyBulkGoalAction()"
                    }
                ]);
            }

            applyBulkGoalAction() {
                const action = document.querySelector('input[name="bulk-action"]:checked');
                if (!action) {
                    UI.toast('يرجى اختيار إجراء', 'error');
                    return;
                }
                
                UI.toast(`تم تطبيق الإجراء: ${action.value}`, 'success');
                document.querySelector('.fixed').remove();
            }

            // Quick add methods
            addTask() {
                const title = prompt('عنوان المهمة:');
                if (!title) return;
                
                const newTask = {
                    id: 'task_' + Date.now(),
                    title,
                    description: '',
                    category: 'عام',
                    priority: 'medium',
                    status: 'pending',
                    dueDate: new Date().toISOString().split('T')[0],
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                this.state.tasks.push(newTask);
                this.state.save();
                UI.toast('تم إضافة المهمة', 'success');
                this.navigate('dashboard');
            }

            addGoal() {
                const title = prompt('عنوان الهدف:');
                if (!title) return;
                
                const newGoal = {
                    id: 'goal_' + Date.now(),
                    title,
                    description: '',
                    type: 'medium-term',
                    category: 'شخصي',
                    priority: 'medium',
                    status: 'active',
                    progress: 0,
                    deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    milestones: [],
                    tags: []
                };
                
                this.state.goals.push(newGoal);
                this.state.save();
                UI.toast('تم إضافة الهدف', 'success');
                this.navigate('advancedGoals');
            }

            addNote() {
                const title = prompt('عنوان الملاحظة:');
                if (!title) return;
                
                const newNote = {
                    id: 'note_' + Date.now(),
                    title,
                    content: '',
                    category: 'عام',
                    tags: [],
                    isEncrypted: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.state.notes.push(newNote);
                this.state.save();
                UI.toast('تم إضافة الملاحظة', 'success');
                this.navigate('secureNotes');
            }

            addReminder() {
                const title = prompt('عنوان التذكير:');
                if (!title) return;
                
                const date = prompt('التاريخ (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
                const time = prompt('الوقت (HH:MM):', '12:00');
                
                UI.toast('تم إضافة التذكير', 'success');
            }

            toggleTaskCompletion(taskId, completed) {
                const task = this.state.tasks.find(t => t.id === taskId);
                if (task) {
                    task.completed = completed;
                    task.status = completed ? 'completed' : 'pending';
                    this.state.save();
                    this.state.updateSidebarStats();
                    this.navigate('dashboard');
                }
            }

            // Settings Methods
            saveSettings() {
                const user = this.state.user;
                if (!user) return;
                
                user.name = document.getElementById('user-name').value;
                user.email = document.getElementById('user-email-input').value;
                user.settings.language = document.getElementById('language').value;
                user.settings.fontSize = document.getElementById('font-size').value;
                user.settings.notifications = document.getElementById('notifications-enabled').checked;
                user.settings.taskReminders = document.getElementById('task-reminders').checked;
                user.settings.goalDeadlines = document.getElementById('goal-deadlines').checked;
                user.settings.weeklyReview = document.getElementById('weekly-review').checked;
                
                this.state.updateUserSettings(user.settings);
                UI.toast('تم حفظ الإعدادات بنجاح', 'success');
            }

            exportAllData() {
                const data = {
                    user: this.state.user,
                    config: this.state.config,
                    goals: this.state.goals,
                    finance: this.state.finance,
                    notes: this.state.notes,
                    projects: this.state.projects,
                    journals: this.state.journals,
                    tasks: this.state.tasks,
                    data: this.state.data,
                    reviewResults: this.state.reviewResults,
                    exportedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `LifeOS_V14_Backup_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                UI.toast('تم تصدير جميع البيانات بنجاح', 'success');
            }

            importData() {
                UI.toast('ميزة استيراد البيانات قيد التطوير', 'info');
            }

            resetData() {
                if (confirm('هل أنت متأكد من إعادة تعيين جميع البيانات؟ هذا الإجراء لا يمكن التراجع عنه.')) {
                    this.state.db.clear();
                    Auth.logout();
                    UI.toast('تم إعادة تعيين جميع البيانات', 'success');
                }
            }

            // Finance Methods
            addTransaction() {
                const modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">النوع *</label>
                            <select id="transaction-type" class="notion-input">
                                <option value="income">دخل</option>
                                <option value="expense">مصروف</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">المبلغ *</label>
                            <input type="number" id="transaction-amount" class="notion-input" placeholder="0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الفئة</label>
                            <select id="transaction-category" class="notion-input">
                                ${this.state.config.categories?.finance.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الوصف</label>
                            <input type="text" id="transaction-description" class="notion-input" placeholder="وصف المعاملة">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">التاريخ</label>
                            <input type="date" id="transaction-date" class="notion-input" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">ملاحظات</label>
                            <textarea id="transaction-notes" class="notion-input h-20" placeholder="ملاحظات إضافية"></textarea>
                        </div>
                    </div>
                `;
                
                UI.modal('إضافة معاملة مالية', modalContent, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'حفظ',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: "App.saveTransaction()"
                    }
                ]);
            }

            saveTransaction() {
                const amount = parseFloat(document.getElementById('transaction-amount').value);
                if (!amount || amount <= 0) {
                    UI.toast('يرجى إدخال مبلغ صحيح', 'error');
                    return;
                }
                
                const transaction = {
                    id: 't_' + Date.now(),
                    type: document.getElementById('transaction-type').value,
                    amount: amount,
                    category: document.getElementById('transaction-category').value,
                    description: document.getElementById('transaction-description').value,
                    date: document.getElementById('transaction-date').value,
                    note: document.getElementById('transaction-notes').value
                };
                
                this.state.finance.transactions.unshift(transaction);
                this.state.save();
                
                document.querySelector('.fixed').remove();
                UI.toast('تم إضافة المعاملة بنجاح', 'success');
                this.navigate('financeAdvanced');
            }

            showAllTransactions() {
                UI.toast('عرض جميع المعاملات', 'info');
            }

            // Journal Methods
            addNewJournal() {
                const modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">عنوان التدوينة *</label>
                            <input type="text" id="journal-title" class="notion-input" placeholder="عنوان التدوينة">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">المحتوى</label>
                            <textarea id="journal-content" class="notion-input h-32" placeholder="اكتب أفكارك ومشاعرك هنا..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">المزاج</label>
                            <select id="journal-mood" class="notion-input">
                                <option value="happy">😊 سعيد</option>
                                <option value="excited">😄 متحمس</option>
                                <option value="neutral">😐 عادي</option>
                                <option value="sad">😔 حزين</option>
                                <option value="angry">😠 غاضب</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الوسوم (مفصولة بفاصلة)</label>
                            <input type="text" id="journal-tags" class="notion-input" placeholder="يوميات, أفكار, تخطيط">
                        </div>
                    </div>
                `;
                
                UI.modal('إضافة تدوينة جديدة', modalContent, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'حفظ',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: "App.saveNewJournal()"
                    }
                ]);
            }

            saveNewJournal() {
                const title = document.getElementById('journal-title').value;
                if (!title) {
                    UI.toast('يرجى إدخال عنوان التدوينة', 'error');
                    return;
                }
                
                const newJournal = {
                    id: 'j_' + Date.now(),
                    title: title,
                    content: document.getElementById('journal-content').value,
                    mood: document.getElementById('journal-mood').value,
                    tags: document.getElementById('journal-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                    date: new Date().toISOString(),
                    createdAt: new Date().toISOString()
                };
                
                this.state.journals.unshift(newJournal);
                this.state.save();
                
                document.querySelector('.fixed').remove();
                UI.toast('تم إضافة التدوينة بنجاح', 'success');
                this.navigate('journalManager');
            }

            viewJournal(id) {
                const journal = this.state.journals.find(j => j.id === id);
                if (journal) {
                    UI.modal(journal.title, `
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-500">${new Date(journal.date).toLocaleDateString('ar-EG')}</span>
                                <span class="px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-xs">${journal.mood}</span>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <p class="text-gray-700 dark:text-gray-300 whitespace-pre-line">${journal.content}</p>
                            </div>
                            ${journal.tags.length > 0 ? `
                                <div>
                                    <h4 class="font-bold mb-2">الوسوم</h4>
                                    <div class="flex gap-2 flex-wrap">
                                        ${journal.tags.map(tag => `
                                            <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300 rounded text-xs">
                                                ${tag}
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `, [
                        {
                            text: 'إغلاق',
                            class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                            onclick: "this.closest('.fixed').remove()"
                        }
                    ]);
                }
            }

            setTodayMood(mood) {
                UI.toast(`تم تعيين المزاج اليومي: ${mood}`, 'success');
            }

            // Notes Methods
            addNewNote() {
                const modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">عنوان الملاحظة *</label>
                            <input type="text" id="note-title" class="notion-input" placeholder="عنوان الملاحظة">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">المحتوى</label>
                            <textarea id="note-content" class="notion-input h-40" placeholder="المحتوى..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الفئة</label>
                            <select id="note-category" class="notion-input">
                                <option value="عام">عام</option>
                                <option value="حسابات">حسابات</option>
                                <option value="أفكار">أفكار</option>
                                <option value="مشاريع">مشاريع</option>
                                <option value="شخصي">شخصي</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">الوسوم</label>
                                <input type="text" id="note-tags" class="notion-input" placeholder="مهم, سري">
                            </div>
                            <div>
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" id="note-encrypted" class="rounded">
                                    <span class="text-sm">تشفير الملاحظة</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `;
                
                UI.modal('إضافة ملاحظة جديدة', modalContent, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'حفظ',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: "App.saveNewNote()"
                    }
                ]);
            }

            saveNewNote() {
                const title = document.getElementById('note-title').value;
                if (!title) {
                    UI.toast('يرجى إدخال عنوان الملاحظة', 'error');
                    return;
                }
                
                const newNote = {
                    id: 'n_' + Date.now(),
                    title: title,
                    content: document.getElementById('note-content').value,
                    category: document.getElementById('note-category').value,
                    tags: document.getElementById('note-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                    isEncrypted: document.getElementById('note-encrypted').checked,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.state.notes.unshift(newNote);
                this.state.save();
                
                document.querySelector('.fixed').remove();
                UI.toast('تم إضافة الملاحظة بنجاح', 'success');
                this.navigate('secureNotes');
            }

            viewNote(id) {
                const note = this.state.notes.find(n => n.id === id);
                if (note) {
                    UI.modal(note.title, `
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="px-2 py-1 rounded-full text-xs ${note.isEncrypted ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600'}">
                                    ${note.isEncrypted ? 'مشفرة' : 'عادية'}
                                </span>
                                <span class="text-sm text-gray-500">${new Date(note.updatedAt).toLocaleDateString('ar-EG')}</span>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                                <p class="text-gray-700 dark:text-gray-300 whitespace-pre-line">${note.isEncrypted ? '🔒 المحتوى مشفر' : note.content}</p>
                            </div>
                            ${note.tags.length > 0 ? `
                                <div>
                                    <h4 class="font-bold mb-2">الوسوم</h4>
                                    <div class="flex gap-2 flex-wrap">
                                        ${note.tags.map(tag => `
                                            <span class="px-2 py-1 bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-300 rounded text-xs">
                                                ${tag}
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `, [
                        {
                            text: 'إغلاق',
                            class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                            onclick: "this.closest('.fixed').remove()"
                        }
                    ]);
                }
            }

            editNote(id) {
                const note = this.state.notes.find(n => n.id === id);
                if (!note) {
                    UI.toast('لم يتم العثور على الملاحظة', 'error');
                    return;
                }
                
                const modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">عنوان الملاحظة</label>
                            <input type="text" id="edit-note-title" class="notion-input" value="${note.title}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">المحتوى</label>
                            <textarea id="edit-note-content" class="notion-input h-40">${note.content}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الفئة</label>
                            <select id="edit-note-category" class="notion-input">
                                <option value="عام" ${note.category === 'عام' ? 'selected' : ''}>عام</option>
                                <option value="حسابات" ${note.category === 'حسابات' ? 'selected' : ''}>حسابات</option>
                                <option value="أفكار" ${note.category === 'أفكار' ? 'selected' : ''}>أفكار</option>
                                <option value="مشاريع" ${note.category === 'مشاريع' ? 'selected' : ''}>مشاريع</option>
                                <option value="شخصي" ${note.category === 'شخصي' ? 'selected' : ''}>شخصي</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الوسوم</label>
                            <input type="text" id="edit-note-tags" class="notion-input" value="${note.tags.join(', ')}">
                        </div>
                    </div>
                `;
                
                UI.modal('تعديل الملاحظة', modalContent, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'حفظ',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: `App.saveNoteEdit('${note.id}')`
                    }
                ]);
            }

            saveNoteEdit(id) {
                const noteIndex = this.state.notes.findIndex(n => n.id === id);
                if (noteIndex === -1) {
                    UI.toast('لم يتم العثور على الملاحظة', 'error');
                    return;
                }
                
                this.state.notes[noteIndex].title = document.getElementById('edit-note-title').value;
                this.state.notes[noteIndex].content = document.getElementById('edit-note-content').value;
                this.state.notes[noteIndex].category = document.getElementById('edit-note-category').value;
                this.state.notes[noteIndex].tags = document.getElementById('edit-note-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                this.state.notes[noteIndex].updatedAt = new Date().toISOString();
                
                this.state.save();
                
                document.querySelector('.fixed').remove();
                UI.toast('تم تحديث الملاحظة بنجاح', 'success');
                this.navigate('secureNotes');
            }

            deleteNote(id) {
                if (confirm('هل أنت متأكد من حذف هذه الملاحظة؟')) {
                    const noteIndex = this.state.notes.findIndex(n => n.id === id);
                    if (noteIndex !== -1) {
                        this.state.notes.splice(noteIndex, 1);
                        this.state.save();
                        UI.toast('تم حذف الملاحظة بنجاح', 'info');
                        this.navigate('secureNotes');
                    }
                }
            }

            decryptNote(id) {
                const note = this.state.notes.find(n => n.id === id);
                if (!note || !note.isEncrypted) return;
                
                const password = prompt('أدخل كلمة المرور لفك التشفير:');
                if (password) {
                    note.isEncrypted = false;
                    this.state.save();
                    UI.toast('تم فك تشفير الملاحظة', 'success');
                    this.viewNote(id);
                }
            }

            filterNotesByType(type) {
                UI.toast(`تم تصفية الملاحظات حسب النوع: ${type}`, 'info');
            }

            // Projects Methods
            addNewProject() {
                const modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">اسم المشروع *</label>
                            <input type="text" id="project-name" class="notion-input" placeholder="اسم المشروع">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الوصف</label>
                            <textarea id="project-description" class="notion-input h-24" placeholder="وصف المشروع..."></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">الحالة</label>
                                <select id="project-status" class="notion-input">
                                    <option value="planning">قيد التخطيط</option>
                                    <option value="in-progress">قيد التنفيذ</option>
                                    <option value="on-hold">معلق</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">الأولوية</label>
                                <select id="project-priority" class="notion-input">
                                    <option value="medium">متوسطة</option>
                                    <option value="high">عالية</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">الموعد النهائي</label>
                                <input type="date" id="project-deadline" class="notion-input" value="${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">التقدم الحالي</label>
                                <input type="range" id="project-progress" min="0" max="100" value="0" class="w-full">
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>0%</span>
                                    <span id="project-progress-value">0%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">اللون</label>
                            <input type="color" id="project-color" class="w-full h-10" value="#3b82f6">
                        </div>
                    </div>
                `;
                
                UI.modal('إضافة مشروع جديد', modalContent, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'حفظ',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: "App.saveNewProject()"
                    }
                ]);
                
                // تحديث قيمة التقدم
                document.getElementById('project-progress').addEventListener('input', function(e) {
                    document.getElementById('project-progress-value').textContent = e.target.value + '%';
                });
            }

            saveNewProject() {
                const name = document.getElementById('project-name').value;
                if (!name) {
                    UI.toast('يرجى إدخال اسم المشروع', 'error');
                    return;
                }
                
                const newProject = {
                    id: 'p_' + Date.now(),
                    name: name,
                    description: document.getElementById('project-description').value,
                    status: document.getElementById('project-status').value,
                    priority: document.getElementById('project-priority').value,
                    progress: parseInt(document.getElementById('project-progress').value),
                    deadline: document.getElementById('project-deadline').value,
                    color: document.getElementById('project-color').value,
                    tasks: [],
                    team: [],
                    notes: '',
                    createdAt: new Date().toISOString()
                };
                
                this.state.projects.unshift(newProject);
                this.state.save();
                
                document.querySelector('.fixed').remove();
                UI.toast('تم إضافة المشروع بنجاح', 'success');
                this.navigate('projects');
            }

            viewProject(id) {
                const project = this.state.projects.find(p => p.id === id);
                if (project) {
                    UI.modal(project.name, `
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="px-2 py-1 rounded-full text-xs ${project.status === 'in-progress' ? 'bg-green-100 text-green-600' : project.status === 'completed' ? 'bg-purple-100 text-purple-600' : 'bg-yellow-100 text-yellow-600'}">
                                    ${project.status === 'planning' ? 'قيد التخطيط' : 
                                      project.status === 'in-progress' ? 'قيد التنفيذ' : 
                                      project.status === 'completed' ? 'مكتمل' : 'معلق'}
                                </span>
                                <span class="text-sm text-gray-500">ينتهي ${project.deadline}</span>
                            </div>
                            
                            <div>
                                <h4 class="font-bold mb-2">الوصف</h4>
                                <p class="text-gray-700 dark:text-gray-300">${project.description}</p>
                            </div>
                            
                            <div>
                                <h4 class="font-bold mb-2">التقدم</h4>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${project.progress}%"></div>
                                </div>
                                <div class="flex justify-between text-sm mt-1">
                                    <span>التقدم</span>
                                    <span class="font-bold">${project.progress}%</span>
                                </div>
                            </div>
                            
                            ${project.tasks.length > 0 ? `
                                <div>
                                    <h4 class="font-bold mb-2">المهام</h4>
                                    <div class="space-y-2">
                                        ${project.tasks.map(task => `
                                            <div class="flex items-center gap-2">
                                                <input type="checkbox" ${task.completed ? 'checked' : ''} class="custom-checkbox">
                                                <span class="${task.completed ? 'line-through text-gray-400' : ''}">
                                                    ${task.title}
                                                </span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${project.notes ? `
                                <div>
                                    <h4 class="font-bold mb-2">ملاحظات</h4>
                                    <p class="text-gray-700 dark:text-gray-300">${project.notes}</p>
                                </div>
                            ` : ''}
                        </div>
                    `, [
                        {
                            text: 'إغلاق',
                            class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                            onclick: "this.closest('.fixed').remove()"
                        }
                    ]);
                }
            }

            editProject(id) {
                const project = this.state.projects.find(p => p.id === id);
                if (!project) {
                    UI.toast('لم يتم العثور على المشروع', 'error');
                    return;
                }
                
                const modalContent = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">اسم المشروع</label>
                            <input type="text" id="edit-project-name" class="notion-input" value="${project.name}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">الوصف</label>
                            <textarea id="edit-project-description" class="notion-input h-24">${project.description}</textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">الحالة</label>
                                <select id="edit-project-status" class="notion-input">
                                    <option value="planning" ${project.status === 'planning' ? 'selected' : ''}>قيد التخطيط</option>
                                    <option value="in-progress" ${project.status === 'in-progress' ? 'selected' : ''}>قيد التنفيذ</option>
                                    <option value="completed" ${project.status === 'completed' ? 'selected' : ''}>مكتمل</option>
                                    <option value="on-hold" ${project.status === 'on-hold' ? 'selected' : ''}>معلق</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">التقدم</label>
                                <input type="range" id="edit-project-progress" min="0" max="100" value="${project.progress}" class="w-full">
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>0%</span>
                                    <span id="edit-project-progress-value">${project.progress}%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                UI.modal('تعديل المشروع', modalContent, [
                    {
                        text: 'إلغاء',
                        class: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                        onclick: "this.closest('.fixed').remove()"
                    },
                    {
                        text: 'حفظ',
                        class: 'bg-blue-600 text-white hover:bg-blue-700',
                        onclick: `App.saveProjectEdit('${project.id}')`
                    }
                ]);
                
                // تحديث قيمة التقدم
                document.getElementById('edit-project-progress').addEventListener('input', function(e) {
                    document.getElementById('edit-project-progress-value').textContent = e.target.value + '%';
                });
            }

            saveProjectEdit(id) {
                const projectIndex = this.state.projects.findIndex(p => p.id === id);
                if (projectIndex === -1) {
                    UI.toast('لم يتم العثور على المشروع', 'error');
                    return;
                }
                
                this.state.projects[projectIndex].name = document.getElementById('edit-project-name').value;
                this.state.projects[projectIndex].description = document.getElementById('edit-project-description').value;
                this.state.projects[projectIndex].status = document.getElementById('edit-project-status').value;
                this.state.projects[projectIndex].progress = parseInt(document.getElementById('edit-project-progress').value);
                this.state.projects[projectIndex].updatedAt = new Date().toISOString();
                
                this.state.save();
                
                document.querySelector('.fixed').remove();
                UI.toast('تم تحديث المشروع بنجاح', 'success');
                this.navigate('projects');
            }

            deleteProject(id) {
                if (confirm('هل أنت متأكد من حذف هذا المشروع؟')) {
                    const projectIndex = this.state.projects.findIndex(p => p.id === id);
                    if (projectIndex !== -1) {
                        this.state.projects.splice(projectIndex, 1);
                        this.state.save();
                        UI.toast('تم حذف المشروع بنجاح', 'info');
                        this.navigate('projects');
                    }
                }
            }

            filterProjectsByStatus(status) {
                UI.toast(`تم تصفية المشاريع حسب الحالة: ${status}`, 'info');
            }

            showGoalFilters() {
                UI.toast('عرض خيارات التصفية', 'info');
            }
        }

        /* ===== 7. INITIALIZATION ===== */
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.App = new AppController();
            window.Auth = Auth;
            window.UI = UI;
        });
    </script>
</body>
</html>